{% extends 'base.html' %}
{% load static %}

{% block title %}{% if editando_outro %}Editar Usu√°rio: {{ usuario_editado.username }}{% else %}Editar Perfil{% endif %}{% endblock %}

{% block content %}
<div id="perfil-react-root">
    <div class="loading-container" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #6ee7b7 0%, #34d399 50%, #10b981 100%); color: white; flex-direction: column;">
        <div class="loading-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.3); border-top: 5px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem;"></div>
        <div>Carregando perfil React...</div>
        <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
            Sistema React inicializando...
        </div>
    </div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<!-- React Dependencies -->
<script src="{% static 'js/vendor/react.development.js' %}"></script>
<script src="{% static 'js/vendor/react-dom.development.js' %}"></script>

<!-- CSRF Token e Props para JavaScript -->
<script>
    window.csrfToken = '{{ csrf_token }}';
    
    // Definir props para o componente React
    window.perfilProps = {
        usuario: {
            id: {{ user.id|default:'null' }},
            username: '{{ user.username|default:"" }}',
            full_name: '{{ user.get_full_name|default:user.username }}',
            email: '{{ user.email|default:"" }}',
            first_name: '{{ user.first_name|default:"" }}',
            last_name: '{{ user.last_name|default:"" }}'
        },
        usuario_editado: {
            id: {{ usuario_editado.id|default:'null' }},
            username: '{{ usuario_editado.username|default:"" }}',
            full_name: '{{ usuario_editado.get_full_name|default:usuario_editado.username }}',
            email: '{{ usuario_editado.email|default:"" }}',
            first_name: '{{ usuario_editado.first_name|default:"" }}',
            last_name: '{{ usuario_editado.last_name|default:"" }}'
        },
        editando_outro: {% if editando_outro %}true{% else %}false{% endif %},
        data_atual: '{{ data_atual|date:"c" }}'
    };
    
    console.log('üöÄ Props definidas:', window.perfilProps);
</script>

<!-- Componente React Bundle Debug -->
<script src="{% static 'js/dist/perfil-debug.bundle.js' %}"></script>

<script>
// Debug script para verificar se tudo est√° carregando
setTimeout(() => {
    console.log('üîç Debug ap√≥s 2 segundos:');
    console.log('- React dispon√≠vel:', typeof React !== 'undefined');
    console.log('- ReactDOM dispon√≠vel:', typeof ReactDOM !== 'undefined');
    console.log('- Container encontrado:', document.getElementById('perfil-react-root') !== null);
    console.log('- Props dispon√≠veis:', typeof window.perfilProps !== 'undefined');
    
    const container = document.getElementById('perfil-react-root');
    if (container) {
        console.log('- Conte√∫do do container:', container.innerHTML.substring(0, 100) + '...');
    }
}, 2000);
</script>

{% endblock %}
