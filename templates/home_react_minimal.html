{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Sistema de Registro de Chamadas{% endblock %}

{% block content %}
<div id="home-react-root">
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 20px;">‚è≥</div>
            <h2>Carregando dashboard...</h2>
            <p>Aguarde enquanto carregamos o sistema</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- React CDN -->
<!-- Scripts removidos do CDN, agora React √© carregado via include central ou arquivos locais -->

<!-- Carregar servi√ßos React primeiro -->
<script src="{% static 'js/dist/react-services.bundle.js' %}"></script>

<!-- Bundle do Componente -->
<script src="{% static 'js/dist/home.bundle.js' %}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Iniciando dashboard minimalista...');
    
    // Verificar se React est√° dispon√≠vel
    if (!window.React || !window.ReactDOM) {
        console.error('‚ùå React ou ReactDOM n√£o est√£o dispon√≠veis');
        return;
    }
    
    // Verificar se o componente est√° dispon√≠vel
    if (!window.HomeReact) {
        console.error('‚ùå HomeReact n√£o est√° dispon√≠vel');
        return;
    }
    
    // Verificar se o container existe
    var container = document.getElementById('home-react-root');
    if (!container) {
        console.error('‚ùå Container n√£o encontrado');
        return;
    }
    
    // Dados m√≠nimos para o componente
    var data = {
        estatisticas: {
            total_unidades: 0,
            total_chamadas: 0,
            chamadas_hoje: 0,
            chamadas_mes: 0,
            executantes: 0,
            solicitantes: 0,
            executante_solicitante: 0
        },
        usuario: {
            first_name: "Usu√°rio",
            username: "usuario"
        },
        ultimas_unidades: [],
        ultimas_chamadas: []
    };
    
    try {
        // Renderizar o componente
        if (window.ReactDOM.createRoot) {
            var root = window.ReactDOM.createRoot(container);
            root.render(window.React.createElement(window.HomeReact, data));
        } else {
            window.ReactDOM.render(window.React.createElement(window.HomeReact, data), container);
        }
        console.log('üéâ Dashboard carregado com sucesso!');
    } catch (e) {
        console.error('‚ùå Erro na renderiza√ß√£o:', e);
        container.innerHTML = '<div style="text-align: center; padding: 50px; color: white;"><h2>‚ö†Ô∏è Erro no Dashboard</h2><p>Ocorreu um erro ao carregar o dashboard React.</p><p>Erro: ' + e.message + '</p><button onclick="location.reload()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">üîÑ Recarregar</button></div>';
    }
});
</script>
{% endblock %}