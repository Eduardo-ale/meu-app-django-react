{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Chamada</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicons/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicons/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/favicons/site.webmanifest' %}">
    <link rel="shortcut icon" href="{% static 'images/favicons/favicon.ico' %}" type="image/x-icon">
    
    <!-- React e dependências -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <style>
        :root {
            --primary-color: #0d6efd;
            --primary-hover: #0b5ed7;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --header-height: 60px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            margin: 0;
            padding: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        body.page-loaded {
            opacity: 1;
        }

        /* ===== LAYOUT STRUCTURE ===== */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .page-wrapper {
            flex: 1;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .page-wrapper.shifted {
            margin-left: 250px;
        }

        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* ===== HEADER DA PÁGINA ===== */
        .page-header-registro {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3);
        }

        .page-header-registro::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .header-content-registro {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            position: relative;
            z-index: 2;
        }

        .header-main-registro {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex: 1;
        }

        .header-icon-registro {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .header-text-registro h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #ffffff 0%, #fecaca 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle-registro {
            font-size: 1.2rem;
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-weight: 400;
        }

        .header-status-registro {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-badge-online {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-badge-online i {
            color: #22c55e;
            font-size: 0.7rem;
            animation: pulse-dot 2s infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes pulse-dot {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Header/Navbar Styles */
        .main-header {
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            padding: 0 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--secondary-color);
        }

        /* Main Content Styles */
        .main-content {
            margin-top: calc(var(--header-height) + 2rem);
            padding: 0 1.5rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        /* ===== SEÇÕES DO FORMULÁRIO ===== */
        .form-section {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border: 1px solid #e1e8ed;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            padding: 0;
            margin-bottom: 2rem;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .form-section:hover {
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
        }

        .section-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            flex-shrink: 0;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .section-subtitle {
            font-size: 0.9rem;
            color: #6b7280;
            margin: 0.25rem 0 0 0;
            font-weight: 400;
        }

        .section-content {
            padding: 2rem;
            background: white;
        }

        /* ===== CAMPOS DE FORMULÁRIO ===== */
        .field-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .position-relative {
            position: relative;
        }

        .field-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .field-label i {
            color: #ef4444;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .required-star {
            color: #ef4444;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .form-control, .form-select {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            width: 100%;
        }

        .form-control:focus, .form-select:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            outline: none;
            background: white;
            transform: translateY(-1px);
        }

        .form-control:valid {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
        }

        .form-control:invalid:not(:placeholder-shown) {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .field-hint {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .field-hint i {
            color: #9ca3af;
            font-size: 0.75rem;
        }

        /* ===== GRID DE CAMPOS ===== */
        .fields-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .field-group.span-2 {
            grid-column: span 2;
        }

        /* ===== AUTOCOMPLETE MUNICÍPIOS ===== */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ef4444;
            border-top: none;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.highlighted {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            color: #15803d;
            transform: translateX(4px);
        }

        .autocomplete-item::before {
            content: '📍';
            margin-right: 4px;
        }

        .autocomplete-no-results {
            padding: 16px;
            text-align: center;
            color: #6c757d;
            font-style: italic;
            border-bottom: none;
        }

        .autocomplete-loading {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            color: #ef4444;
            display: none;
        }

        .autocomplete-loading.show {
            display: block;
        }

        .autocomplete-loading i {
            animation: spin 1s linear infinite;
        }

        .autocomplete-stats {
            padding: 8px 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #e9ecef;
            font-size: 0.8rem;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        @keyframes slideDown {
            from { 
                opacity: 0; 
                transform: translateY(-10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== INDICADOR DE PROGRESSO ===== */
        .progress-indicator-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #e1e8ed;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .progress-circle {
            position: relative;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-background {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 4;
        }

        .progress-ring-fill {
            fill: none;
            stroke: #ef4444;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-dasharray: 251;
            stroke-dashoffset: 251;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
        }

        .progress-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* ===== SEÇÃO DE DATA/HORA ===== */
        .datetime-section {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            color: white;
            border: none;
            box-shadow: 0 8px 30px rgba(30, 64, 175, 0.2);
            position: relative;
            overflow: hidden;
        }

        .datetime-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="rgba(255,255,255,0.03)"><polygon points="0,0 1000,0 0,100"/></svg>');
            pointer-events: none;
        }

        .datetime-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .datetime-label i {
            color: #93c5fd;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .datetime-value {
            color: white;
            font-size: 1.75rem;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
        }

        /* ===== BOTÕES E AÇÕES ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 12px 35px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
            color: white;
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-primary:disabled {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn-outline-primary {
            border: 2px solid #ef4444;
            color: #ef4444;
            background: transparent;
        }

        .btn-outline-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #fafbfc 0%, #f3f4f6 100%);
            padding: 2rem;
            border-radius: 0 0 16px 16px;
            margin-left: -2rem;
            margin-right: -2rem;
            margin-bottom: -2rem;
        }

        /* ===== RESPONSIVIDADE MELHORADA ===== */
        @media (max-width: 768px) {
            .page-wrapper {
                padding: 1rem;
            }

            .section-header {
                padding: 1rem 1.5rem;
                flex-direction: row;
                text-align: left;
            }

            .section-content {
                padding: 1.5rem;
            }

            .fields-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .field-group.span-2 {
                grid-column: span 1;
            }

            .section-icon {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
                padding: 1rem 2rem;
                font-size: 0.95rem;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.75rem;
                padding: 1.5rem;
            }

            .datetime-section {
                padding: 1.25rem 1.5rem;
                text-align: center;
            }

            .datetime-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .section-header {
                padding: 0.875rem 1rem;
                gap: 0.75rem;
            }

            .section-content {
                padding: 1rem;
            }

            .section-title {
                font-size: 1rem;
            }

            .section-subtitle {
                font-size: 0.8rem;
            }

            .field-label {
                font-size: 0.9rem;
            }

            .form-control, .form-select {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .datetime-section {
                padding: 1rem;
            }

            .datetime-value {
                font-size: 1.25rem;
            }
        }

        /* ===== BREADCRUMB MODERNO ===== */
        .breadcrumb-container {
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }

        .breadcrumb-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #10b981, #f59e0b);
        }

        .breadcrumb-modern {
            display: flex;
            align-items: center;
            margin: 0;
            padding: 0;
            list-style: none;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb-item-modern {
            display: flex;
            align-items: center;
            position: relative;
            animation: fadeInBreadcrumb 0.6s ease-out;
        }

        .breadcrumb-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            text-decoration: none;
            color: #64748b;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .breadcrumb-link:hover {
            color: #3b82f6;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-color: #cbd5e1;
            text-decoration: none;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .breadcrumb-link i {
            font-size: 0.9rem;
            color: #94a3b8;
            transition: color 0.3s ease;
        }

        .breadcrumb-link:hover i {
            color: #3b82f6;
        }

        .breadcrumb-separator {
            color: #cbd5e1;
            font-size: 0.7rem;
            margin: 0 0.5rem;
            animation: pulse 2s infinite;
        }

        .breadcrumb-current-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
            position: relative;
            overflow: hidden;
        }

        .breadcrumb-current-text::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        .breadcrumb-current-text i {
            font-size: 0.9rem;
            color: #fecaca;
            flex-shrink: 0;
        }

        .breadcrumb-icon {
            width: 16px;
            height: 16px;
            object-fit: contain;
            margin-right: 8px;
        }

        .header-icon-registro img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .section-icon img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        /* ===== ANIMAÇÕES E TRANSIÇÕES ===== */
        @keyframes fadeInBreadcrumb {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* ===== ANIMAÇÕES DE ENTRADA ===== */
        .form-section {
            animation: slideInUp 0.6s ease-out;
        }

        .form-section:nth-child(1) { animation-delay: 0.1s; }
        .form-section:nth-child(2) { animation-delay: 0.2s; }
        .form-section:nth-child(3) { animation-delay: 0.3s; }
        .form-section:nth-child(4) { animation-delay: 0.4s; }

        .progress-indicator-container {
            animation: bounceIn 0.8s ease-out;
        }

        .datetime-section {
            animation: fadeInScale 0.6s ease-out 0.2s both;
        }

        /* ===== TOASTS E NOTIFICAÇÕES ===== */
        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 1050;
            pointer-events: none;
        }

        .toast-notification {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
            padding: 1.25rem 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            min-width: 320px;
            pointer-events: auto;
            animation: slideInRight 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        .toast-success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #ffffff 100%);
        }

        .toast-error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .toast-warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }

        .toast-info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
        }

        .toast-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .toast-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #1f2937;
            font-size: 0.95rem;
        }

        .toast-close {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .toast-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #1f2937;
        }

        .toast-message {
            color: #4b5563;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        .toast-notification.closing {
            animation: slideOutRight 0.3s ease-in forwards;
        }

        /* ===== ESTADOS DE LOADING ===== */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            z-index: 10;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e5e7eb;
            border-top: 3px solid #ef4444;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .field-group.loading {
            position: relative;
            pointer-events: none;
        }

        .field-group.loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            z-index: 5;
        }

        /* ===== CAMPO CNES ESPECÍFICO ===== */
        .cnes-field {
            position: relative;
        }

        .cnes-field input {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            letter-spacing: 1px;
            font-size: 1.1rem;
            text-align: center;
        }

        .cnes-field .field-hint {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.75rem;
        }

        .cnes-field .field-hint i {
            color: #0284c7;
        }

        /* ===== CAMPO CNES DESTACADO ===== */
        .cnes-field-highlighted {
            background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%);
            border: 3px solid #f59e0b;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.15);
            position: relative;
            overflow: hidden;
        }

        .cnes-field-highlighted::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f59e0b, #d97706, #b45309);
            animation: shimmerEffect 2s infinite;
        }

        .cnes-label-container {
            margin-bottom: 1rem;
        }

        .cnes-label-enhanced {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: #92400e;
        }

        .cnes-label-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .cnes-label-text {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }

        .cnes-label-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #92400e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .cnes-label-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .cnes-label-badge-auxilio {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: white !important;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3) !important;
        }

        .cnes-help-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #78716c;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .cnes-help-text i {
            color: #f59e0b;
            font-size: 1rem;
        }

        /* Input CNES melhorado */
        .cnes-field-highlighted input {
            border: 3px solid #f59e0b !important;
            border-radius: 12px !important;
            padding: 1rem !important;
            font-weight: 600 !important;
            font-size: 1.1rem !important;
            background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%) !important;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.1) !important;
            transition: all 0.3s ease !important;
            text-align: center !important;
            letter-spacing: 2px !important;
        }

        .cnes-field-highlighted input:focus {
            border-color: #d97706 !important;
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.2) !important;
            transform: scale(1.02) !important;
            outline: none !important;
        }

        /* Banner de atenção CNES */
        .cnes-attention-banner {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: pulseAttention 2s infinite;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }

        .cnes-attention-banner-info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important;
            border: 2px solid #60a5fa !important;
            animation: none !important;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.2) !important;
        }

        .cnes-attention-icon {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
            animation: bounce 1s infinite;
        }

        .cnes-attention-icon-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            color: white !important;
            animation: none !important;
        }

        .cnes-attention-text {
            color: #7f1d1d;
            font-weight: 500;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .cnes-attention-text-info {
            color: #1e40af !important;
        }

        .cnes-attention-text strong {
            color: #991b1b;
            font-weight: 700;
        }

        /* Animação shimmer */
        @keyframes shimmerEffect {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: 200px 0;
            }
        }

        /* Animação de atenção */
        @keyframes pulseAttention {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
                border-color: #ef4444;
            }
            50% {
                box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
                border-color: #dc2626;
            }
        }

        /* Animação bounce */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
            60% {
                transform: translateY(-4px);
            }
        }

        /* Responsivo para campo CNES destacado */
        @media (max-width: 768px) {
            .cnes-field-highlighted {
                padding: 1rem;
                margin: 0.5rem 0;
            }

            .cnes-label-enhanced {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                font-size: 1rem;
            }

            .cnes-label-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .cnes-label-title {
                font-size: 1.1rem;
            }
        }

        /* ===== SEÇÃO INFORMAÇÕES DO CADASTRANTE ===== */
        .cadastrante-info-field {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
            font-weight: 600;
            color: #92400e;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .cadastrante-info-field::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f59e0b, #d97706, #b45309);
            animation: shimmerCadastrante 2s infinite;
        }

        .cadastrante-nome {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            color: #78350f;
            text-transform: lowercase;
            position: relative;
            z-index: 2;
        }

        .cadastrante-nome::before {
            content: '👤';
            font-size: 0.9rem;
            margin-right: 0.25rem;
        }

        .cadastrante-data {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            color: #78350f;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
        }

        .cadastrante-data::before {
            content: '📅';
            font-size: 0.9rem;
            margin-right: 0.25rem;
        }

        .cadastrante-info-field:hover {
            background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
            border-color: #d97706;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.25);
            transform: translateY(-1px);
        }

        /* Animação shimmer para os campos do cadastrante */
        @keyframes shimmerCadastrante {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: 200px 0;
            }
        }

        /* Estilo especial para a seção do cadastrante */
        .form-section:has(.cadastrante-info-field) {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 2px solid #f59e0b;
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.15);
        }

        .form-section:has(.cadastrante-info-field) .section-header {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
        }

        .form-section:has(.cadastrante-info-field) .section-icon {
            background: linear-gradient(135deg, #ffffff 0%, #fef3c7 100%);
            color: #f59e0b;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .form-section:has(.cadastrante-info-field) .section-title {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .form-section:has(.cadastrante-info-field) .section-subtitle {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Responsividade para seção do cadastrante */
        @media (max-width: 768px) {
            .cadastrante-info-field {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .cadastrante-nome,
            .cadastrante-data {
                font-size: 0.9rem;
            }
        }

        /* ===== CAMPO CONTATO TELEFÔNICO CNES ===== */
        input[name="contato_telefonico_cnes"] {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0284c7;
            border-radius: 10px;
            font-weight: 600;
            color: #0369a1;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            text-align: center;
            transition: all 0.3s ease;
        }

        input[name="contato_telefonico_cnes"]:focus {
            border-color: #0369a1;
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1);
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            outline: none;
        }

        input[name="contato_telefonico_cnes"]:not(:placeholder-shown) {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-color: #16a34a;
            color: #15803d;
        }

        /* Ícone específico para o campo telefone CNES */
        input[name="contato_telefonico_cnes"] + .field-hint {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.75rem;
        }

        input[name="contato_telefonico_cnes"] + .field-hint i {
            color: #0284c7;
        }

        /* ===== CARDS DE VERIFICAÇÃO DA UNIDADE ===== */
        
        /* Card da Unidade Encontrada */
        .unidade-encontrada-card {
            margin-top: 1rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #16a34a;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.15);
            animation: slideInFromTop 0.4s ease-out;
        }

        .unidade-card-header {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .unidade-card-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .unidade-card-badge i {
            font-size: 1.1rem;
            color: #dcfce7;
        }

        .unidade-card-status {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 500;
        }

        .unidade-card-content {
            padding: 1.5rem;
        }

        .unidade-nome {
            font-size: 1.4rem;
            font-weight: 700;
            color: #15803d;
            margin: 0 0 1.25rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .unidade-nome::before {
            content: '🏥';
            font-size: 1.2rem;
        }

        .unidade-dados-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .unidade-dado-item {
            background: white;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 0.875rem;
            transition: all 0.3s ease;
        }

        .unidade-dado-item:hover {
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            border-color: #16a34a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.1);
        }

        .unidade-dado-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #059669;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .unidade-dado-label i {
            color: #10b981;
            font-size: 0.9rem;
        }

        .unidade-dado-value {
            font-size: 0.95rem;
            font-weight: 500;
            color: #065f46;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .unidade-card-footer {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #bbf7d0;
            margin-top: 1rem;
        }

        .unidade-card-footer small {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: #059669;
            font-weight: 500;
        }

        /* Card da Unidade Não Encontrada */
        .unidade-nao-encontrada-card {
            margin-top: 1rem;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
            animation: slideInFromTop 0.4s ease-out;
        }

        .unidade-nao-encontrada-header {
            background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .unidade-nao-encontrada-icon {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .unidade-nao-encontrada-icon i {
            font-size: 1.5rem;
            color: #fecaca;
        }

        .unidade-nao-encontrada-content {
            flex: 1;
        }

        .unidade-nao-encontrada-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0 0 0.75rem 0;
            color: white;
        }

        .unidade-nao-encontrada-text {
            font-size: 0.95rem;
            color: #fecaca;
            margin: 0;
            line-height: 1.5;
        }

        .unidade-nao-encontrada-actions {
            padding: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-cadastrar-unidade {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
        }

        .btn-cadastrar-unidade:hover {
            background: linear-gradient(135deg, #15803d 0%, #16a34a 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.4);
            color: white;
            text-decoration: none;
        }

        .btn-tentar-novamente {
            background: transparent;
            border: 2px solid #6b7280;
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            color: #6b7280;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-tentar-novamente:hover {
            background: #6b7280;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }

        .unidade-nao-encontrada-info {
            padding: 0 1.5rem 1.5rem 1.5rem;
        }

        .unidade-nao-encontrada-info .alert {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 0.875rem 1rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .unidade-nao-encontrada-info .alert i {
            color: #3b82f6;
            font-size: 1rem;
            flex-shrink: 0;
        }

        /* Animações */
        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsividade para os cards de unidade */
        @media (max-width: 768px) {
            .unidade-dados-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .unidade-nao-encontrada-header {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .unidade-nao-encontrada-actions {
                padding: 1rem;
                flex-direction: column;
                gap: 0.75rem;
            }

            .btn-cadastrar-unidade,
            .btn-tentar-novamente {
                width: 100%;
                justify-content: center;
            }

            .unidade-nao-encontrada-info {
                padding: 0 1rem 1rem 1rem;
            }

            .unidade-card-header {
                padding: 0.875rem 1rem;
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .unidade-card-content {
                padding: 1rem;
            }

            .unidade-nome {
                font-size: 1.2rem;
                text-align: center;
                justify-content: center;
            }
        }

        .cnes-status {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            pointer-events: none;
        }

        .cnes-status.valid {
            color: #10b981;
        }

        .cnes-status.invalid {
            color: #f59e0b;
        }

        .cnes-status.empty {
            color: #9ca3af;
        }

        /* ===== COMPONENTE CNES COM API ===== */
        .cnes-container {
            position: relative;
        }

        .cnes-consult-btn {
            position: absolute;
            right: 45px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .cnes-consult-btn:hover {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        .cnes-info-card {
            margin-top: 1rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.1);
            animation: slideDown 0.3s ease-out;
        }

        .cnes-info-header {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .cnes-info-header .badge {
            margin-left: auto;
            background-color: rgba(255, 255, 255, 0.2) !important;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }

        .cnes-info-content {
            padding: 1rem;
        }

        .cnes-info-item {
            margin-bottom: 0.5rem;
            color: #16a34a;
            font-size: 0.9rem;
        }

        .cnes-info-item:last-child {
            margin-bottom: 0;
        }

        .cnes-info-item strong {
            color: #166534;
            margin-right: 0.5rem;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== MODAL CNES NOVO DESIGN ===== */
        .cnes-modal-custom {
            border: none;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .cnes-info-container-novo {
            padding: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .cnes-badge-novo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95rem;
            margin: 20px 20px 20px 20px;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .cnes-badge-novo i {
            font-size: 1.1rem;
        }

        .cnes-nome-principal {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 20px 10px 20px;
            line-height: 1.2;
        }

        .cnes-razao-social {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 1rem;
            margin: 0 20px 25px 20px;
            font-weight: 500;
        }

        .cnes-razao-social i {
            color: #94a3b8;
        }

        .cnes-info-grid-novo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 0 20px 20px 20px;
        }

        .cnes-info-col {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cnes-info-item-novo {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .cnes-info-item-novo:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .cnes-info-label-novo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #475569;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .cnes-info-label-novo i {
            color: #64748b;
            font-size: 1rem;
        }

        .cnes-info-value-novo {
            color: #1e293b;
            font-size: 1rem;
            line-height: 1.4;
            word-wrap: break-word;
            font-weight: 500;
        }

        .cnes-modal-footer-custom {
            background: #f1f5f9;
            border-top: 1px solid #e2e8f0;
            padding: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-preencher-cnes {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .btn-preencher-cnes:hover {
            background: linear-gradient(135deg, #15803d 0%, #16a34a 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        .cnes-modal-footer-custom .btn-secondary {
            background: #64748b;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cnes-modal-footer-custom .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .cnes-info-grid-novo {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .cnes-nome-principal {
                font-size: 1.5rem;
            }
            
            .cnes-modal-footer-custom {
                flex-direction: column;
            }
        }

        /* Modal responsivo */
        @media (max-width: 768px) {
            .cnes-modal-header {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .cnes-modal-info {
                padding: 0 1rem;
            }

            .cnes-modal-footer {
                padding: 1rem;
            }

            .cnes-modal-value {
                padding-left: 1rem;
            }
        }

        /* ===== RESPONSIVIDADE PRINCIPAL ===== */
        @media (max-width: 768px) {
            .header-container {
                padding: 0 1rem;
            }

            .main-content {
                padding: 0 1rem;
            }

            .breadcrumb-container {
                padding: 0.75rem 1rem;
                margin-bottom: 1.5rem;
            }

            .breadcrumb-modern {
                gap: 0.25rem;
            }

            .breadcrumb-link,
            .breadcrumb-current-text {
                padding: 0.375rem 0.5rem;
                font-size: 0.8rem;
            }

            .breadcrumb-link span,
            .breadcrumb-current-text span {
                display: none;
            }

            .breadcrumb-link i,
            .breadcrumb-current-text i {
                font-size: 1rem;
            }

            .breadcrumb-separator {
                margin: 0 0.25rem;
                font-size: 0.6rem;
            }

            /* Responsividade do header */
            .page-header-registro {
                padding: 1.5rem;
            }

            .header-content-registro {
                flex-direction: column;
                gap: 1.5rem;
            }

            .header-main-registro {
                gap: 1rem;
            }

            .header-icon-registro {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }

            .header-text-registro h1 {
                font-size: 2rem;
            }

            .header-subtitle-registro {
                font-size: 1rem;
            }

            .status-badge-online {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
            }

            /* Layout responsivo */
            .page-wrapper.shifted {
                margin-left: 0;
            }

            /* Progress responsive */
            .progress-indicator-container {
                padding: 1rem;
            }

            .progress-circle svg {
                width: 100px;
                height: 100px;
            }

            .progress-text {
                font-size: 1rem;
            }

            .progress-label {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .header-content-registro {
                text-align: center;
            }

            .header-main-registro {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .header-text-registro h1 {
                font-size: 1.8rem;
            }

            .header-subtitle-registro {
                font-size: 0.9rem;
            }

            /* Progress mobile */
            .progress-circle svg {
                width: 80px;
                height: 80px;
            }

            .progress-text {
                font-size: 0.9rem;
            }

            .progress-label {
                font-size: 0.75rem;
            }

            /* Toast responsive */
            .toast-container {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                right: 1rem;
            }

            .toast-notification {
                min-width: auto;
                width: 100%;
                margin-bottom: 0.75rem;
            }

            .toast-title {
                font-size: 0.9rem;
            }

            .toast-message {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Container para a aplicação React -->
    <div id="app"></div>

    <!-- Scripts do Formulário -->
    <script type="text/babel">
        // ===== HOOKS E COMPONENTES ===== 
        
        // Hook useForm
        const useForm = (initialValues) => {
            const [values, setValues] = React.useState(initialValues);
            const [errors, setErrors] = React.useState({});
            const [isLoading, setIsLoading] = React.useState(false);
            const [toast, setToast] = React.useState(null);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setValues(prev => ({
                    ...prev,
                    [name]: value
                }));
                
                // Limpar erro do campo quando usuário começar a digitar
                if (errors[name]) {
                    setErrors(prev => ({
                        ...prev,
                        [name]: ''
                    }));
                }
            };

            const handleSubmit = async (e, submitFunction) => {
                e.preventDefault();
                setIsLoading(true);
                setErrors({});

                try {
                    await submitFunction(values);
                } catch (error) {
                    console.error('Erro no formulário:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            return {
                values,
                errors,
                isLoading,
                toast,
                handleChange,
                handleSubmit,
                setErrors,
                setToast,
                // expor setter para integrações programáticas
                setValues
            };
        };

        // Hook useUnidadeVerification
        const useUnidadeVerification = () => {
            const [isVerified, setIsVerified] = React.useState(false);
            const [isVerifying, setIsVerifying] = React.useState(false);
            const [unidadeEncontrada, setUnidadeEncontrada] = React.useState(null);
            const [unidadeNaoEncontrada, setUnidadeNaoEncontrada] = React.useState(false);

            const verificarUnidade = async (nomeUnidade) => {
                if (!nomeUnidade || !nomeUnidade.trim()) {
                    ToastManager.warning('Digite o nome da unidade para verificar', 3000);
                    return;
                }
                
                setIsVerifying(true);
                setUnidadeEncontrada(null);
                setUnidadeNaoEncontrada(false);
                setIsVerified(false);
                
                try {
                    const resultado = await consultarUnidadeSaude(nomeUnidade);
                    
                    if (resultado.sucesso && resultado.unidade) {
                        // Unidade encontrada
                        setUnidadeEncontrada(resultado.unidade);
                    setIsVerified(true);
                        setUnidadeNaoEncontrada(false);
                        
                        // Preencher automaticamente o campo município se disponível
                        if (resultado.unidade.municipio && window.preencherCampoMunicipio) {
                            setTimeout(() => {
                                window.preencherCampoMunicipio(resultado.unidade.municipio);
                            }, 1000);
                        }
                        
                        ToastManager.success('✅ Unidade encontrada no sistema!' + 
                            (resultado.unidade.municipio ? ' Município preenchido automaticamente.' : ''), 5000);
                        console.log('Unidade encontrada:', resultado.unidade);
                    } else if (resultado.naoEncontrada) {
                        // Unidade não encontrada
                        setUnidadeEncontrada(null);
                        setUnidadeNaoEncontrada(true);
                        setIsVerified(false);
                        ToastManager.warning('⚠️ Unidade não cadastrada no sistema', 4000);
                        console.log('Unidade não encontrada');
                    } else {
                        // Erro na consulta
                        setUnidadeEncontrada(null);
                        setUnidadeNaoEncontrada(false);
                        setIsVerified(false);
                        ToastManager.error('❌ Erro ao verificar unidade: ' + resultado.erro, 5000);
                        console.error('Erro na verificação:', resultado.erro);
                    }
                } catch (error) {
                    setUnidadeEncontrada(null);
                    setUnidadeNaoEncontrada(false);
                    setIsVerified(false);
                    ToastManager.error('❌ Erro ao conectar com o servidor', 5000);
                    console.error('Erro na verificação:', error);
                } finally {
                    setIsVerifying(false);
                }
            };

            const limparVerificacao = () => {
                setIsVerified(false);
                setUnidadeEncontrada(null);
                setUnidadeNaoEncontrada(false);
            };

            return {
                isVerified,
                isVerifying,
                unidadeEncontrada,
                unidadeNaoEncontrada,
                verificarUnidade,
                limparVerificacao,
                setIsVerified
            };
        };

        // Componente InputField
        const InputField = ({ name, value, onChange, required, error, placeholder, maxLength, type = "text" }) => {
            return (
                <input
                    className={`form-control ${error ? 'is-invalid' : ''}`}
                    type={type}
                    name={name}
                    value={value}
                    onChange={onChange}
                    required={required}
                    placeholder={placeholder}
                    maxLength={maxLength}
                />
            );
        };

        // Componente SelectField  
        const SelectField = ({ name, value, onChange, required, error, options }) => {
            return (
                <select
                    className={`form-select ${error ? 'is-invalid' : ''}`}
                    name={name}
                    value={value}
                    onChange={onChange}
                    required={required}
                >
                    <option value="">Selecione uma opção</option>
                    {options.map(option => (
                        <option key={option.value} value={option.value}>
                            {option.label}
                        </option>
                    ))}
                </select>
            );
        };

        // Componente TextAreaField
        const TextAreaField = ({ name, value, onChange, required, error, placeholder, rows = 4 }) => {
            return (
                <textarea
                    className={`form-control ${error ? 'is-invalid' : ''}`}
                    name={name}
                    value={value}
                    onChange={onChange}
                    required={required}
                    placeholder={placeholder}
                    rows={rows}
                />
            );
        };

        // Função para lidar com o cadastro de nova unidade
        const handleCadastrarUnidade = (nomeUnidade) => {
            // Obter dados CNES armazenados globalmente
            const dadosCNES = window.ultimosDadosCNES || null;
            
            // Construir URL com parâmetros
            let url = '/accounts/unidades-saude/criar/';
            const params = new URLSearchParams();
            
            // Adicionar nome da unidade
            if (nomeUnidade && nomeUnidade.trim()) {
                params.append('nome', nomeUnidade.trim());
            }
            
            // Adicionar dados CNES se disponíveis
            if (dadosCNES) {
                if (dadosCNES.nome) params.append('nome_cnes', dadosCNES.nome);
                if (dadosCNES.codigo_cnes) params.append('cnes', dadosCNES.codigo_cnes);
                if (dadosCNES.municipio) params.append('municipio', dadosCNES.municipio);
                if (dadosCNES.telefone) params.append('telefone', dadosCNES.telefone);
                if (dadosCNES.endereco) params.append('endereco', dadosCNES.endereco);
                if (dadosCNES.uf) params.append('uf', dadosCNES.uf);
            }
            
            if (params.toString()) {
                url += '?' + params.toString();
            }
            
            console.log('🔗 Redirecionando para cadastro com parâmetros:', url);
            ToastManager.info('Redirecionando para o cadastro de unidade...', 2000);
            
            // Redirecionar na mesma aba
            window.location.href = url;
        };

        // Componente UnidadeVerification completo
        const UnidadeVerification = ({ 
            value, 
            onChange, 
            onVerify, 
            isVerified, 
            isLoading, 
            error, 
            unidadeEncontrada, 
            unidadeNaoEncontrada,
            onLimparVerificacao 
        }) => {
            
            // Limpar verificação quando o valor mudar
            React.useEffect(() => {
                if (onLimparVerificacao) {
                    onLimparVerificacao();
                }
            }, [value]);

            return (
                <div>
                <div className="input-group">
                    <input
                        className={`form-control ${error ? 'is-invalid' : isVerified ? 'is-valid' : ''}`}
                        type="text"
                        name="unidade"
                        value={value}
                        onChange={onChange}
                        placeholder="Digite o nome da unidade de saúde"
                        required
                    />
                    <button
                        className="btn btn-outline-primary"
                        type="button"
                        onClick={onVerify}
                        disabled={isLoading || !value.trim()}
                    >
                            {isLoading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin"></i>
                                    Verificando...
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-search"></i>
                                    Verificar
                                </>
                            )}
                    </button>
                    </div>

                    {/* Card da Unidade Encontrada */}
                    {unidadeEncontrada && (
                        <div className="unidade-encontrada-card">
                            <div className="unidade-card-header">
                                <div className="unidade-card-badge">
                                    <i className="fas fa-check-circle"></i>
                                    Unidade Cadastrada
                                </div>
                                <div className="unidade-card-status">
                                    <i className="fas fa-circle text-success"></i>
                                    Ativa
                                </div>
                            </div>
                            
                            <div className="unidade-card-content">
                                <h4 className="unidade-nome">{unidadeEncontrada.nome}</h4>
                                
                                <div className="unidade-dados-grid">
                                    <div className="unidade-dado-item">
                                        <div className="unidade-dado-label">
                                            <i className="fas fa-map-marker-alt"></i>
                                            Município
                                        </div>
                                        <div className="unidade-dado-value">
                                            {unidadeEncontrada.municipio || 'Não informado'}
                                        </div>
                                    </div>
                                    
                                    <div className="unidade-dado-item">
                                        <div className="unidade-dado-label">
                                            <i className="fas fa-phone"></i>
                                            Telefone
                                        </div>
                                        <div className="unidade-dado-value">
                                            {unidadeEncontrada.telefone || 'Não informado'}
                                        </div>
                                    </div>
                                    
                                    <div className="unidade-dado-item">
                                        <div className="unidade-dado-label">
                                            <i className="fas fa-user-md"></i>
                                            Responsável
                                        </div>
                                        <div className="unidade-dado-value">
                                            {unidadeEncontrada.responsavel || 'Não informado'}
                                        </div>
                                    </div>
                                    
                                    <div className="unidade-dado-item">
                                        <div className="unidade-dado-label">
                                            <i className="fas fa-map-signs"></i>
                                            Endereço
                                        </div>
                                        <div className="unidade-dado-value">
                                            {unidadeEncontrada.endereco || 'Não informado'}
                                        </div>
                                    </div>
                                    
                                    {unidadeEncontrada.cnes && (
                                        <div className="unidade-dado-item">
                                            <div className="unidade-dado-label">
                                                <i className="fas fa-id-card"></i>
                                                CNES
                                            </div>
                                            <div className="unidade-dado-value">
                                                {unidadeEncontrada.cnes}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {unidadeEncontrada.tipo && (
                                        <div className="unidade-dado-item">
                                            <div className="unidade-dado-label">
                                                <i className="fas fa-building"></i>
                                                Tipo
                                            </div>
                                            <div className="unidade-dado-value">
                                                {unidadeEncontrada.tipo}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="unidade-card-footer">
                                    <small className="text-muted">
                                        <i className="fas fa-database"></i>
                                        Dados obtidos do sistema de cadastro
                                    </small>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Card da Unidade Não Encontrada */}
                    {unidadeNaoEncontrada && (
                        <div className="unidade-nao-encontrada-card">
                            <div className="unidade-nao-encontrada-header">
                                <div className="unidade-nao-encontrada-icon">
                                    <i className="fas fa-exclamation-triangle"></i>
                                </div>
                                <div className="unidade-nao-encontrada-content">
                                    <h4 className="unidade-nao-encontrada-title">
                                        Unidade não cadastrada no sistema
                                    </h4>
                                    <p className="unidade-nao-encontrada-text">
                                        A unidade "{value}" não foi encontrada na base de dados.
                                        É necessário cadastrá-la primeiro para prosseguir.
                                    </p>
                                </div>
                            </div>
                            
                            <div className="unidade-nao-encontrada-actions">
                                <button 
                                    type="button"
                                    className="btn btn-primary btn-cadastrar-unidade"
                                    onClick={() => handleCadastrarUnidade(value)}
                                >
                                    <i className="fas fa-plus-circle"></i>
                                    Cadastrar Unidade de Saúde
                                </button>
                                <button 
                                    type="button" 
                                    className="btn btn-outline-secondary btn-tentar-novamente"
                                    onClick={onVerify}
                                >
                                    <i className="fas fa-redo"></i>
                                    Verificar Novamente
                                </button>
                            </div>
                            
                            <div className="unidade-nao-encontrada-info">
                                <div className="alert alert-info">
                                    <i className="fas fa-info-circle"></i>
                                    <strong>Dica:</strong> O formulário de cadastro será pré-preenchido automaticamente com os dados da consulta CNES (se disponível). Após cadastrar, retorne aqui e clique em "Verificar Novamente".
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Componente de Campo CNES com consulta à API
        const CNESField = ({ name, value, onChange, required, error, placeholder, maxLength }) => {
            const [cnesData, setCnesData] = React.useState(null);
            const [isConsulting, setIsConsulting] = React.useState(false);
            const [lastConsulted, setLastConsulted] = React.useState('');

            // Consultar automaticamente quando tiver 7 dígitos (apenas se digitado pelo usuário)
            React.useEffect(() => {
                const cnesLimpo = value.replace(/\D/g, '');
                if (cnesLimpo.length === 7 && cnesLimpo !== lastConsulted && value.trim() !== '') {
                    // Adicionar delay para evitar consultas desnecessárias ao carregar a página
                    const timer = setTimeout(() => {
                    handleConsultarCNES();
                    }, 1000);
                    
                    return () => clearTimeout(timer);
                }
            }, [value]);

            const handleConsultarCNES = async () => {
                const cnesLimpo = value.replace(/\D/g, '');
                console.log('Valor original do CNES:', value);
                console.log('Valor limpo do CNES:', cnesLimpo);
                console.log('Comprimento do CNES:', cnesLimpo.length);
                
                if (cnesLimpo.length !== 7) {
                    ToastManager.warning('Digite um código CNES com 7 dígitos para consultar.', 3000);
                    return;
                }

                setIsConsulting(true);
                setLastConsulted(cnesLimpo);
                
                try {
                    const resultado = await consultarCNES(cnesLimpo);
                    
                    if (resultado.sucesso) {
                        setCnesData(resultado.dados);
                        
                        // Armazenar dados globalmente para debug e testes
                        window.ultimosDadosCNES = resultado.dados;
                        
                        ToastManager.success('Estabelecimento encontrado! Clique no ícone para ver detalhes.', 3000);
                        
                        // Disponibilizar função global para abrir modal
                        window.abrirModalCNES = abrirModalCNES;
                        
                        console.log('💡 DICA: Para testar o preenchimento automático manualmente, digite no console:');
                        console.log('window.preencherFormularioComDadosCNES(window.ultimosDadosCNES)');
                    } else {
                        setCnesData(null);
                        ToastManager.error(resultado.erro, 5000);
                    }
                } catch (error) {
                    setCnesData(null);
                    ToastManager.error('Erro ao consultar CNES: ' + error.message, 5000);
                } finally {
                    setIsConsulting(false);
                }
            };

            const cnesLength = value.replace(/\D/g, '').length;

            return (
                <div className="cnes-container">
                    <div className="position-relative">
                        <InputField
                            name={name}
                            value={value}
                            onChange={onChange}
                            required={required}
                            error={error}
                            placeholder={placeholder}
                            maxLength={maxLength}
                        />
                        <div className={`cnes-status ${cnesLength === 0 ? 'empty' : cnesLength === 7 ? 'valid' : 'invalid'}`} id="cnes-status">
                            {isConsulting ? (
                                <i className="fas fa-spinner fa-spin"></i>
                            ) : (
                                <i className={`fas ${cnesLength === 0 ? 'fa-keyboard' : cnesLength === 7 ? 'fa-check-circle' : 'fa-exclamation-triangle'}`} id="cnes-status-icon"></i>
                            )}
                        </div>
                        {cnesLength === 7 && !isConsulting && (
                            <button
                                type="button"
                                className="btn btn-outline-secondary btn-sm cnes-consult-btn"
                                onClick={handleConsultarCNES}
                                title="Consultar na API do Ministério da Saúde"
                            >
                                <i className="fas fa-search"></i>
                            </button>
                        )}
                    </div>

                    {cnesData && (
                        <div className="cnes-info-card">
                            <div className="cnes-info-header">
                                <i className="fas fa-hospital text-success"></i>
                                <strong>Estabelecimento Encontrado</strong>
                                <span className="badge bg-success">Ministério da Saúde</span>
                                <button 
                                    type="button" 
                                    className="btn btn-sm btn-light ms-2" 
                                    onClick={() => abrirModalCNES(cnesData)}
                                    title="Ver detalhes completos"
                                >
                                    <i className="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div className="cnes-info-content">
                                <div className="cnes-info-item">
                                    <strong>Nome:</strong> {cnesData.nome || 'Não informado'}
                                </div>
                                {cnesData.municipio && (
                                    <div className="cnes-info-item">
                                        <strong>Município:</strong> {cnesData.municipio} - {cnesData.uf}
                                    </div>
                                )}
                                <div className="text-center mt-2">
                                    <small className="text-muted">
                                        <i className="fas fa-mouse-pointer"></i> Clique no ícone para ver detalhes e 
                                        <strong className="text-success"> preencher automaticamente nome e telefone da unidade</strong>
                                    </small>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Componente MunicipioAutocomplete
        const MunicipioAutocomplete = ({ name, value, onChange, required, error, placeholder }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const [results, setResults] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(false);
            const [currentIndex, setCurrentIndex] = React.useState(-1);
            const [debounceTimer, setDebounceTimer] = React.useState(null);
            const [helpText, setHelpText] = React.useState('⚡ Digite 2+ caracteres • 🔄 Busca inteligente • 📊 Máx. 10 resultados');
            
            const inputRef = React.useRef(null);
            const dropdownRef = React.useRef(null);

            // Limpar timer ao desmontar componente
            React.useEffect(() => {
                return () => {
                    if (debounceTimer) {
                        clearTimeout(debounceTimer);
                    }
                };
            }, [debounceTimer]);

            // Fechar dropdown ao clicar fora
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (inputRef.current && !inputRef.current.contains(event.target) && 
                        dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, []);

            const updateHelpText = (query) => {
                if (query.length === 0) {
                    setHelpText('⚡ Digite 2+ caracteres • 🔄 Busca inteligente • 📊 Máx. 10 resultados');
                } else if (query.length === 1) {
                    setHelpText('⚡ Digite mais 1 caractere para iniciar a busca...');
                } else {
                    setHelpText('🔄 Buscando municípios do MS...');
                }
            };

            const searchMunicipios = async (query) => {
                setIsLoading(true);
                
                try {
                    const response = await fetch(`/api/municipios/autocomplete/?q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    
                    setResults(data.results || []);
                    setCurrentIndex(-1);
                    setIsOpen(true);
                    
                    // Atualizar texto de ajuda com resultado
                    if (data.results && data.results.length > 0) {
                        setHelpText(`✅ ${data.results.length} município(s) encontrado(s)`);
                    } else {
                        setHelpText('❌ Nenhum município encontrado');
                    }
                    
                } catch (error) {
                    console.error('Erro ao buscar municípios:', error);
                    setResults([]);
                    setHelpText('❌ Erro na busca. Tente novamente.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleInputChange = (e) => {
                const inputValue = e.target.value;
                onChange(e);
                
                // Limpar timer anterior
                if (debounceTimer) {
                    clearTimeout(debounceTimer);
                }

                // Atualizar texto de ajuda
                updateHelpText(inputValue);

                // Se menos de 2 caracteres, esconder dropdown
                if (inputValue.length < 2) {
                    setIsOpen(false);
                    setResults([]);
                    return;
                }

                // Debounce de 300ms
                const timer = setTimeout(() => {
                    searchMunicipios(inputValue);
                }, 300);
                
                setDebounceTimer(timer);
            };

            const handleKeyDown = (e) => {
                if (!isOpen || results.length === 0) return;

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        setCurrentIndex(prev => Math.min(prev + 1, results.length - 1));
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        setCurrentIndex(prev => Math.max(prev - 1, -1));
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (currentIndex >= 0 && currentIndex < results.length) {
                            selectMunicipio(results[currentIndex].nome);
                        }
                        break;
                    case 'Escape':
                        setIsOpen(false);
                        break;
                }
            };

            const selectMunicipio = (nomeM) => {
                const fakeEvent = {
                    target: {
                        name: name,
                        value: nomeM
                    }
                };
                onChange(fakeEvent);
                setIsOpen(false);
                setCurrentIndex(-1);
                setHelpText(`✅ Município selecionado: ${nomeM}`);
            };

            const handleFocus = () => {
                if (value.length >= 2 && results.length > 0) {
                    setIsOpen(true);
                }
            };

            return (
                <div className="autocomplete-container position-relative">
                    <input
                        ref={inputRef}
                        className={`form-control ${error ? 'is-invalid' : ''}`}
                        type="text"
                        name={name}
                        value={value}
                        onChange={handleInputChange}
                        onKeyDown={handleKeyDown}
                        onFocus={handleFocus}
                        required={required}
                        placeholder={placeholder}
                        autoComplete="off"
                    />
                    
                    {isLoading && (
                        <div className="autocomplete-loading">
                            <i className="fas fa-spinner fa-spin"></i>
                        </div>
                    )}
                    
                    {isOpen && (
                        <div ref={dropdownRef} className="autocomplete-dropdown show">
                            {results.length === 0 ? (
                                <div className="autocomplete-no-results">
                                    <i className="fas fa-search"></i>
                                    Nenhum município encontrado no MS
                                </div>
                            ) : (
                                <>
                                    <div className="autocomplete-stats">
                                        <span><i className="fas fa-map-marker-alt"></i> {results.length} município(s)</span>
                                        <span><i className="fas fa-clock"></i> MS - Brasil</span>
                                    </div>
                                    {results.map((municipio, index) => (
                                        <div
                                            key={index}
                                            className={`autocomplete-item ${index === currentIndex ? 'highlighted' : ''}`}
                                            onClick={() => selectMunicipio(municipio.nome)}
                                            onMouseEnter={() => setCurrentIndex(index)}
                                        >
                                            {municipio.nome}
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                    )}
                    
                    <div className="field-hint mt-1">
                        <i className="fas fa-info-circle"></i>
                        <span className={helpText.includes('✅') ? 'text-success' : ''}>{helpText}</span>
                    </div>
                </div>
            );
        };

        // Componente Breadcrumb Moderno
        const Breadcrumb = () => {
            React.useEffect(() => {
                // Animação escalonada dos itens do breadcrumb
                const items = document.querySelectorAll('.breadcrumb-item-modern');
                items.forEach((item, index) => {
                    item.style.animationDelay = `${index * 0.1}s`;
                });
            }, []);

            return (
                <nav aria-label="breadcrumb" className="breadcrumb-container">
                    <ol className="breadcrumb-modern">
                        <li className="breadcrumb-item-modern">
                            <a href="/" className="breadcrumb-link" title="Ir para página inicial">
                                <i className="fas fa-home"></i>
                                <span>Início</span>
                            </a>
                            <i className="fas fa-chevron-right breadcrumb-separator"></i>
                        </li>
                        <li className="breadcrumb-item-modern">
                            <a href="/accounts/unidades-saude/" className="breadcrumb-link" title="Voltar para gestão de unidades">
                                <i className="fas fa-hospital-alt"></i>
                                <span>Unidades de Saúde</span>
                            </a>
                            <i className="fas fa-chevron-right breadcrumb-separator"></i>
                        </li>
                        <li className="breadcrumb-item-modern breadcrumb-current">
                            <span className="breadcrumb-current-text">
                                <img src="/static/images/headphones.gif" alt="Headphones" className="breadcrumb-icon" />
                                <span>Registro de Chamada</span>
                            </span>
                        </li>
                    </ol>
                </nav>
            );
        };

        // Componente do Menu Lateral (simplificado)
        const Sidebar = () => {
            return null; // Temporariamente desabilitado
        };

        // Botão do Menu
        const MenuToggle = ({ isOpen, onClick }) => {
            return (
                <button 
                    className="menu-toggle"
                    id="menu-toggle"
                    onClick={onClick}
                    aria-label="Abrir menu"
                    title="Abrir menu"
                >
                    <i className="fas fa-bars" id="menu-toggle-icon"></i>
                </button>
            );
        };

        // Função para formatar data e hora
        function formatarDataHora(data) {
            return new Intl.DateTimeFormat('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).format(data);
        }

        // Sistema de Toasts Modernos
        const ToastManager = {
            container: null,
            
            init() {
                this.container = document.getElementById('toast-container');
                // Se não existir, criar o container
                if (!this.container) {
                    this.container = document.createElement('div');
                    this.container.id = 'toast-container';
                    this.container.className = 'toast-container';
                    document.body.appendChild(this.container);
                }
            },
            
            show(message, type = 'info', duration = 5000) {
                if (!this.container) this.init();
                
                // Verificar novamente se o container existe
                if (!this.container) {
                    console.warn('Toast container não pôde ser criado');
                    return null;
                }
                
                const toast = this.createToast(message, type);
                this.container.appendChild(toast);
                
                // Auto-remove após duração especificada
                setTimeout(() => {
                    this.remove(toast);
                }, duration);
                
                return toast;
            },
            
            createToast(message, type) {
                const toast = document.createElement('div');
                toast.className = `toast-notification toast-${type}`;
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                
                const titles = {
                    success: 'Sucesso!',
                    error: 'Erro!',
                    warning: 'Atenção!',
                    info: 'Informação'
                };
                
                toast.innerHTML = `
                    <div class="toast-header">
                        <div class="toast-title">
                            <i class="fas ${icons[type]}"></i>
                            ${titles[type]}
                        </div>
                        <button class="toast-close" onclick="ToastManager.remove(this.closest('.toast-notification'))">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="toast-message">${message}</div>
                `;
                
                return toast;
            },
            
            remove(toast) {
                toast.classList.add('closing');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            },
            
            success(message, duration) {
                return this.show(message, 'success', duration);
            },
            
            error(message, duration) {
                return this.show(message, 'error', duration);
            },
            
            warning(message, duration) {
                return this.show(message, 'warning', duration);
            },
            
            info(message, duration) {
                return this.show(message, 'info', duration);
            }
        };

        // Função para validar campos obrigatórios
        function validarCamposObrigatorios(values) {
            const camposObrigatorios = [
                'nome', 'telefone', 'funcao', 'setor', 
                'unidade', 'municipio', 'tipo_chamada', 'status', 
                'nome_atendente', 'descricao', 'solucao'
            ];
            
            const camposVazios = camposObrigatorios.filter(campo => 
                !values[campo] || values[campo].trim() === ''
            );
            
            // Validação específica para CNES (apenas se preenchido)
            if (values.cnes && values.cnes.trim() !== '' && !validarCNES(values.cnes)) {
                camposVazios.push('cnes_invalido');
            }
            
            return {
                valido: camposVazios.length === 0,
                camposVazios: camposVazios
            };
        }

        // Função para aplicar máscara de telefone
        function aplicarMascaraTelefone(valor) {
            valor = valor.replace(/\D/g, '');
            
            if (valor.length <= 10) {
                valor = valor.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else {
                valor = valor.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            }
            
            return valor;
        }

        // Função para aplicar máscara de CNES
        function aplicarMascaraCNES(valor) {
            // Remove tudo que não for dígito
            valor = valor.replace(/\D/g, '');
            
            // Limita a 7 dígitos
            if (valor.length > 7) {
                valor = valor.substring(0, 7);
            }
            
            return valor;
        }

        // Função para consultar unidade de saúde na base de dados
        async function consultarUnidadeSaude(nomeUnidade) {
            if (!nomeUnidade || nomeUnidade.trim() === '') {
                return { sucesso: false, erro: 'Nome da unidade não pode estar vazio' };
            }

            const baseUrl = window.location.origin;
            const apiPath = '/accounts/api/unidade-saude/';
            const fullUrl = `${baseUrl}${apiPath}`;
            
            console.log('=== DEBUG CONSULTA UNIDADE DE SAÚDE ===');
            console.log('Nome da unidade:', nomeUnidade);
            console.log('URL da consulta:', fullUrl);
            console.log('======================================');
            
            try {
                ToastManager.info('Verificando se a unidade está cadastrada no sistema...', 2000);
                
                const response = await fetch(fullUrl, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCsrfToken(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        nome_unidade: nomeUnidade.trim()
                    }),
                    cache: 'no-cache'
                });

                console.log('Status da resposta:', response.status);

                if (!response.ok) {
                    if (response.status === 404) {
                        try {
                            const errorData = await response.json();
                            console.warn('📋 Unidade não encontrada:', errorData);
                            
                            if (errorData.todas_unidades && errorData.todas_unidades.length > 0) {
                                console.log('📋 Unidades disponíveis no sistema:');
                                errorData.todas_unidades.forEach((nome, index) => {
                                    console.log(`   ${index + 1}. ${nome}`);
                                });
                            }
                            
                            if (errorData.unidades_similares && errorData.unidades_similares.length > 0) {
                                console.log('💡 Unidades similares encontradas:');
                                errorData.unidades_similares.forEach((nome, index) => {
                                    console.log(`   ${index + 1}. ${nome}`);
                                });
                            }
                            
                            return { 
                                sucesso: false, 
                                erro: errorData.erro || 'Unidade não encontrada',
                                naoEncontrada: true,
                                unidadesDisponiveis: errorData.todas_unidades || [],
                                unidadesSimilares: errorData.unidades_similares || []
                            };
                        } catch (e) {
                            const errorText = await response.text();
                            console.error('Erro ao decodificar resposta 404:', errorText);
                        return { 
                            sucesso: false, 
                            erro: 'Unidade não encontrada',
                            naoEncontrada: true 
                        };
                        }
                    }
                    
                    const errorText = await response.text();
                    console.error('Erro na resposta:', errorText);
                    return { 
                        sucesso: false, 
                        erro: `Erro ${response.status}: ${response.statusText}` 
                    };
                }

                const resultado = await response.json();
                console.log('Resultado da consulta:', resultado);

                if (resultado.sucesso && resultado.unidade) {
                    // Armazenar resultado globalmente para debug
                    window.ultimaUnidadeConsultada = resultado.unidade;
                    
                    console.log('💡 DICA: Para testar a verificação manualmente, digite no console:');
                    console.log('window.consultarUnidadeSaude("Nome da Unidade")');
                    
                    return {
                        sucesso: true,
                        unidade: resultado.unidade
                    };
                } else {
                    window.ultimaUnidadeConsultada = null;
                    console.warn('⚠️ Resposta inesperada da API:', resultado);
                    return {
                        sucesso: false,
                        erro: resultado.erro || 'Unidade não encontrada no sistema',
                        naoEncontrada: true,
                        unidadesDisponiveis: resultado.todas_unidades || [],
                        unidadesSimilares: resultado.unidades_similares || []
                    };
                }
                
            } catch (error) {
                console.error('Erro detalhado na consulta da unidade:', error);
                return { 
                    sucesso: false, 
                    erro: `Erro de rede: ${error.message}` 
                };
            }
        }

        // Função para validar CNES
        function validarCNES(cnes) {
            // CNES deve ter exatamente 7 dígitos numéricos
            const cnesLimpo = cnes.replace(/\D/g, '');
            return cnesLimpo.length === 7;
        }

        // Função para consultar API do CNES via proxy Django (versão melhorada)
        async function consultarCNES(codigoCNES) {
            // Limpar completamente o código CNES
            let cnesLimpo = String(codigoCNES).replace(/[^0-9]/g, '');
            
            // Validar se tem exatamente 7 dígitos
            if (cnesLimpo.length !== 7) {
                console.warn('CNES inválido - deve ter 7 dígitos:', cnesLimpo);
                return { sucesso: false, erro: 'Código CNES deve ter exatamente 7 dígitos' };
            }

            // Construir URL de forma segura
            const baseUrl = window.location.origin;
            const apiPath = '/accounts/api/cnes/';
            const fullUrl = `${baseUrl}${apiPath}${cnesLimpo}/`;
            
            console.log('=== DEBUG CONSULTA CNES ===');
            console.log('Código original:', codigoCNES);
            console.log('Código limpo:', cnesLimpo);
            console.log('URL completa:', fullUrl);
            console.log('=========================');
            
            try {
                ToastManager.info('Consultando CNES na base de dados do Ministério da Saúde...', 3000);
                
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCsrfToken(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    cache: 'no-cache'
                });

                console.log('Status da resposta:', response.status);
                console.log('URL da requisição:', response.url);

                if (!response.ok) {
                    const errorText = await response.text().catch(() => '');
                    console.error('Erro na resposta:', errorText || response.statusText);
                    
                    // Tratamento específico para indisponibilidade do serviço externo
                    if (response.status === 502 || response.status === 504) {
                        return {
                            sucesso: false,
                            erro: 'Serviço do Ministério da Saúde indisponível no momento (erro 50x). Tente novamente em alguns minutos.'
                        };
                    }

                    if (response.status === 404) {
                        return { 
                            sucesso: false, 
                            erro: 'Código CNES não encontrado na base de dados do Ministério da Saúde' 
                        };
                    }
                    
                    return { 
                        sucesso: false, 
                        erro: `Erro ${response.status}: ${response.statusText}` 
                    };
                }

                const resultado = await response.json();
                console.log('Resultado da consulta:', resultado);

                return resultado;
                
            } catch (error) {
                console.error('Erro detalhado na consulta CNES:', error);
                return { 
                    sucesso: false, 
                    erro: 'Não foi possível consultar o CNES agora. Verifique sua conexão e tente novamente.'
                };
            }
        }

        // Função auxiliar para obter CSRF token
        function getCsrfToken() {
            const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfInput) {
                return csrfInput.value;
            }
            
            const csrfCookie = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='));
            
            if (csrfCookie) {
                return csrfCookie.split('=')[1];
            }
            
            console.warn('CSRF token não encontrado');
            return '';
        }

        // Função para abrir modal com dados do CNES
        function abrirModalCNES(dadosCNES) {
            const modal = document.getElementById('cnesModal');
            const modalBody = document.getElementById('cnesModalBody');
            
            if (!modal || !modalBody) {
                // Criar modal se não existir
                criarModalCNES(dadosCNES);
                return;
            }

            // Preencher dados no modal conforme design da imagem
            modalBody.innerHTML = `
                <div class="cnes-info-container-novo">
                    <!-- Badge CNES -->
                    <div class="cnes-badge-novo">
                        <i class="fas fa-hospital-alt"></i>
                        CNES: ${dadosCNES.codigo_cnes || dadosCNES.codigo || 'N/A'}
                    </div>
                    
                    <!-- Nome principal -->
                    <h2 class="cnes-nome-principal">${dadosCNES.nome_fantasia || dadosCNES.nome || 'Nome não informado'}</h2>
                    
                    <!-- Razão social -->
                    <div class="cnes-razao-social">
                                <i class="fas fa-building"></i>
                        ${dadosCNES.nome_razao_social || 'Razão social não informada'}
                        </div>

                    <!-- Grid de informações -->
                    <div class="cnes-info-grid-novo">
                        <!-- Coluna esquerda -->
                        <div class="cnes-info-col">
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                <i class="fas fa-map-marker-alt"></i>
                                Localização
                            </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.descricao_municipio || dadosCNES.municipio || 'Não informado'} - ${dadosCNES.sigla_uf || dadosCNES.uf || 'N/A'}
                            </div>
                        </div>

                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-map-signs"></i>
                                    Endereço
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.endereco_estabelecimento || dadosCNES.endereco || 'Não informado'}${dadosCNES.numero_estabelecimento ? ', ' + dadosCNES.numero_estabelecimento : ''}
                            </div>
                            </div>
                            
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-phone"></i>
                                    Telefone
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.numero_telefone_estabelecimento || dadosCNES.telefone || 'Não informado'}
                            </div>
                            </div>
                            
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-file-alt"></i>
                                    CNPJ
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.numero_cnpj_entidade || 'Não informado'}
                            </div>
                            </div>
                        </div>
                        
                        <!-- Coluna direita -->
                        <div class="cnes-info-col">
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-building"></i>
                                    Tipo de Unidade
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.descricao_nivel_hierarquia || dadosCNES.tipo || 'Não informado'}
                            </div>
                            </div>
                            
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-map"></i>
                                    Bairro/CEP
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.bairro_estabelecimento || 'Não informado'}${dadosCNES.codigo_cep_estabelecimento ? ' - CEP: ' + dadosCNES.codigo_cep_estabelecimento : ''}
                            </div>
                            </div>
                            
                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-envelope"></i>
                                    E-mail
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.endereco_email_estabelecimento || dadosCNES.email || 'Não informado'}
                            </div>
                    </div>

                            <div class="cnes-info-item-novo">
                                <div class="cnes-info-label-novo">
                                    <i class="fas fa-cogs"></i>
                                    Gestão
                                </div>
                                <div class="cnes-info-value-novo">
                                    ${dadosCNES.tipo_gestao || 'E'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Mostrar modal
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
        }

        // Função para criar modal CNES se não existir
        function criarModalCNES(dadosCNES) {
            const modalHTML = `
                <div class="modal fade" id="cnesModal" tabindex="-1" aria-labelledby="cnesModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content cnes-modal-custom">
                            <div class="modal-body p-0" id="cnesModalBody">
                                <!-- Conteúdo será preenchido dinamicamente -->
                            </div>
                            <div class="modal-footer cnes-modal-footer-custom">
                                <button type="button" class="btn btn-success btn-preencher-cnes" id="preencherDadosCnes" title="Preenche automaticamente os campos 'Nome da Unidade de Saúde' e 'Contato Telefônico CNES' no formulário">
                                    <i class="fas fa-download me-2"></i>
                                    Preencher com os Dados da Unidade no Formulário
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-2"></i>
                                    Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Adicionar modal ao DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Configurar evento do botão preencher dados
            const preencherBtn = document.getElementById('preencherDadosCnes');
            if (preencherBtn) {
                preencherBtn.addEventListener('click', function() {
                    preencherFormularioComDadosCNES(dadosCNES);
                    const modal = bootstrap.Modal.getInstance(document.getElementById('cnesModal'));
                    if (modal) {
                        modal.hide();
                    }
                });
            }
            
            // Chamar novamente para preencher o conteúdo
            setTimeout(() => {
                abrirModalCNES(dadosCNES);
            }, 100);
        }
        
        // Função para preencher formulário com dados do CNES
        function preencherFormularioComDadosCNES(dados) {
            console.log('=== INICIANDO PREENCHIMENTO AUTOMÁTICO ===');
            console.log('Dados do CNES recebidos:', dados);
            
            try {
                // Determinar o nome da unidade a partir dos dados do CNES
                const nomeUnidade = dados.nome_fantasia || dados.nome || dados.nome_razao_social || 'Nome não disponível';
                console.log('Nome da unidade a ser preenchido:', nomeUnidade);
                
                // Determinar o telefone da unidade a partir dos dados do CNES
                const telefoneUnidade = dados.numero_telefone_estabelecimento || dados.telefone || 'Não informado';
                console.log('Telefone da unidade a ser preenchido:', telefoneUnidade);
                
                // Listar todos os inputs disponíveis para debug
                const todosInputs = document.querySelectorAll('input');
                console.log('Todos os inputs encontrados na página:', todosInputs);
                
                // Buscar o campo Nome da Unidade de Saúde com múltiplos seletores
                let campoUnidade = document.querySelector('input[name="unidade"]');
                console.log('Seletor input[name="unidade"]:', campoUnidade);
                
                // Se não encontrar, tentar outros seletores possíveis
                if (!campoUnidade) {
                    campoUnidade = document.querySelector('input[placeholder*="unidade"]');
                    console.log('Seletor input[placeholder*="unidade"]:', campoUnidade);
                }
                if (!campoUnidade) {
                    campoUnidade = document.querySelector('.input-group input[type="text"]');
                    console.log('Seletor .input-group input[type="text"]:', campoUnidade);
                }
                if (!campoUnidade) {
                    campoUnidade = document.querySelector('input[placeholder*="Digite o nome da unidade"]');
                    console.log('Seletor input[placeholder*="Digite o nome da unidade"]:', campoUnidade);
                }
                
                console.log('Campo unidade selecionado final:', campoUnidade);
                
                if (campoUnidade && dados) {
                    // Criar um descritor de propriedade para forçar o React a detectar a mudança
                    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
                    
                    // Definir o valor usando o setter nativo
                    nativeInputValueSetter.call(campoUnidade, nomeUnidade);
                    
                    // Criar e disparar evento de input sintético que o React reconhece
                    const inputEvent = new Event('input', {
                        bubbles: true,
                        cancelable: true,
                    });
                    
                    // Adicionar propriedades que o React espera
                    Object.defineProperty(inputEvent, 'target', {
                        writable: false,
                        value: campoUnidade
                    });
                    
                    Object.defineProperty(inputEvent, 'currentTarget', {
                        writable: false,
                        value: campoUnidade
                    });
                    
                    // Disparar o evento
                    campoUnidade.dispatchEvent(inputEvent);
                    
                    // Também disparar evento change
                    const changeEvent = new Event('change', {
                        bubbles: true,
                        cancelable: true,
                    });
                    
                    Object.defineProperty(changeEvent, 'target', {
                        writable: false,
                        value: campoUnidade
                    });
                    
                    campoUnidade.dispatchEvent(changeEvent);
                    
                    // Forçar foco e blur para garantir que o React detecte
                    setTimeout(() => {
                        campoUnidade.focus();
                        setTimeout(() => {
                            campoUnidade.blur();
                            
                            // Verificar se o valor foi definido
                                                        console.log('Valor final do campo após preenchimento:', campoUnidade.value);
                             
                             // Verificar se o preenchimento realmente funcionou
                             setTimeout(() => {
                                 const valorFinal = campoUnidade.value;
                                 console.log('=== VERIFICAÇÃO FINAL ===');
                                 console.log('Valor esperado:', nomeUnidade);
                                 console.log('Valor atual do campo:', valorFinal);
                                 console.log('Preenchimento bem-sucedido:', valorFinal === nomeUnidade);
                                 
                                 if (valorFinal === nomeUnidade || valorFinal.includes(nomeUnidade.substring(0, 10))) {
                                     console.log('✅ PREENCHIMENTO DO NOME CONFIRMADO COM SUCESSO!');
                                     
                                     // Preencher o campo de telefone CNES
                                     if (window.preencherCampoTelefoneCNES) {
                                         window.preencherCampoTelefoneCNES(telefoneUnidade);
                                     }
                                     
                                     ToastManager.success(`✅ Dados da unidade preenchidos automaticamente! Nome: "${nomeUnidade}" | Telefone: "${telefoneUnidade}"`, 5000);
                                     
                                     // Marcar como verificado
                                     if (window.marcarUnidadeComoVerificada) {
                                         window.marcarUnidadeComoVerificada();
                                     }
                                 } else {
                                     console.log('❌ PREENCHIMENTO FALHOU - Tentando método alternativo...');
                                     // Tentar método alternativo
                                     if (window.preencherCampoReact) {
                                         window.preencherCampoReact(nomeUnidade);
                                         // Também tentar preencher telefone
                                         if (window.preencherCampoTelefoneCNES) {
                                             window.preencherCampoTelefoneCNES(telefoneUnidade);
                                         }
                                     }
                                 }
                             }, 200);
                             
                         }, 100);
                     }, 100);
                    
                } else {
                    console.error('Campo unidade não encontrado ou dados CNES inválidos');
                    console.log('Dados recebidos:', dados);
                    console.log('Campo encontrado:', campoUnidade);
                    
                    // Tentar abordagem alternativa de digitação simulada
                    console.log('Tentando abordagem alternativa de digitação simulada...');
                    
                    if (window.preencherCampoReact && window.preencherCampoReact(nomeUnidade)) {
                        console.log('Preenchimento via digitação simulada executado');
                        ToastManager.success(`Nome da unidade "${nomeUnidade}" preenchido automaticamente (modo alternativo)!`, 4000);
                        
                        // Marcar como verificado após digitação
                        setTimeout(() => {
                            if (window.marcarUnidadeComoVerificada) {
                                window.marcarUnidadeComoVerificada();
                            }
                        }, nomeUnidade.length * 50 + 500);
                        
                        // Também tentar preencher telefone
                        if (window.preencherCampoTelefoneCNES) {
                            window.preencherCampoTelefoneCNES(telefoneUnidade);
                        }
                    } else {
                        ToastManager.error('Erro: Não foi possível preencher os campos automaticamente. Nome: ' + nomeUnidade + ' | Telefone: ' + telefoneUnidade, 8000);
                    }
                }
            } catch (error) {
                console.error('Erro ao preencher formulário com dados do CNES:', error);
                ToastManager.error('Erro ao preencher dados no formulário: ' + error.message, 4000);
            }
        }

        // Função para gerenciar classes dinâmicas
        function updateDynamicClasses(isMenuOpen, isLoading, isVerified, cnesLength) {
            // Sidebar
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const pageWrapper = document.getElementById('page-wrapper');
            const menuToggle = document.getElementById('menu-toggle');
            const menuToggleIcon = document.getElementById('menu-toggle-icon');
            
            if (sidebar) {
                sidebar.className = `sidebar ${isMenuOpen ? 'show' : ''}`;
            }
            if (sidebarOverlay) {
                sidebarOverlay.style.display = isMenuOpen ? 'block' : 'none';
                sidebarOverlay.className = `sidebar-overlay ${isMenuOpen ? 'show' : ''}`;
            }
            if (pageWrapper) {
                pageWrapper.className = `page-wrapper ${isMenuOpen ? 'shifted' : ''}`;
            }
            if (menuToggle) {
                menuToggle.className = `menu-toggle ${isMenuOpen ? 'active' : ''}`;
                menuToggle.setAttribute('aria-label', isMenuOpen ? 'Fechar menu' : 'Abrir menu');
                menuToggle.setAttribute('title', isMenuOpen ? 'Fechar menu' : 'Abrir menu');
            }
            if (menuToggleIcon) {
                menuToggleIcon.className = `fas ${isMenuOpen ? 'fa-times' : 'fa-bars'}`;
            }
            
            // CNES Status
            const cnesStatus = document.getElementById('cnes-status');
            const cnesStatusIcon = document.getElementById('cnes-status-icon');
            const cnesHintStatus = document.getElementById('cnes-hint-status');
            
            if (cnesStatus && cnesStatusIcon) {
                let statusClass = 'cnes-status ';
                let iconClass = 'fas ';
                
                if (cnesLength === 0) {
                    statusClass += 'empty';
                    iconClass += 'fa-keyboard';
                } else if (cnesLength === 7) {
                    statusClass += 'valid';
                    iconClass += 'fa-check-circle';
                } else {
                    statusClass += 'invalid';
                    iconClass += 'fa-exclamation-triangle';
                }
                
                cnesStatus.className = statusClass;
                cnesStatusIcon.className = iconClass;
            }
            
            if (cnesHintStatus) {
                cnesHintStatus.textContent = `Status: ${cnesLength}/7 dígitos preenchidos`;
            }
            
            // Submit Button
            const submitButton = document.getElementById('submit-button');
            if (submitButton) {
                submitButton.className = `btn btn-primary ${isLoading ? 'disabled' : ''}`;
                submitButton.disabled = isLoading || !isVerified;
            }
        }

        // Componente Principal com Layout (simplificado)
        const Layout = () => {
            React.useEffect(() => {
                // Adicionar classe de animação ao body
                document.body.classList.add('page-loaded');
                
                // Inicializar sistema de toasts
                ToastManager.init();
            }, []);

            return (
                <div className="app-container">
                    <div className="page-wrapper">
                        <div className="content-container">
                            <Breadcrumb />
                            <RegistroChamadaForm />
                        </div>
                    </div>
                </div>
            );
        };

        // Componente do Formulário
        const RegistroChamadaForm = () => {
            const [dataHora, setDataHora] = React.useState(new Date());

            // Atualizar data e hora a cada segundo
            React.useEffect(() => {
                const timer = setInterval(() => {
                    setDataHora(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // Calcular progresso
            const [progressData, setProgressData] = React.useState({ filledFields: 0, progressPercent: 0, strokeOffset: 251 });

            const {
                values,
                errors,
                isLoading,
                toast,
                handleChange,
                handleSubmit,
                setToast
            } = useForm({
                nome: '',
                telefone: '',
                funcao: '',
                setor: '',
                tipo_chamada: '',
                status: '',
                descricao: '',
                unidade: '',
                municipio: '',
                cnes: '',
                contato_telefonico_cnes: '',
                nome_atendente: '',
                solucao: ''
            });

            // Atualizar progresso quando valores mudarem
            React.useEffect(() => {
                // Contar apenas os campos obrigatórios preenchidos (excluindo CNES e contato_telefonico_cnes que são opcionais)
                const camposObrigatorios = ['nome', 'telefone', 'funcao', 'setor', 'unidade', 'municipio', 'tipo_chamada', 'status', 'nome_atendente', 'descricao', 'solucao'];
                const filledFields = camposObrigatorios.filter(campo => values[campo] && values[campo].trim() !== '').length;
                
                // Adicionar 2 pontos pelos campos de cadastrante (sempre preenchidos)
                const totalFieldsIncludingCadastrante = filledFields + 2; // +2 pelos campos de cadastrante
                const totalFields = 13; // 11 campos obrigatórios + 2 campos de cadastrante
                
                const progressPercent = Math.round((totalFieldsIncludingCadastrante / totalFields) * 100);
                const strokeOffset = 251 - (251 * Math.min(totalFieldsIncludingCadastrante / totalFields, 1));
                
                // Atualizar elementos DOM diretamente
                const progressRing = document.getElementById('progress-ring-fill');
                const progressText = document.getElementById('progress-text');
                const progressLabel = document.getElementById('progress-label');
                
                if (progressRing) {
                    progressRing.style.strokeDashoffset = strokeOffset;
                    // Garantir que o stroke-dasharray esteja definido
                    if (!progressRing.style.strokeDasharray) {
                        progressRing.style.strokeDasharray = '251';
                    }
                }
                if (progressText) {
                    progressText.textContent = `${progressPercent}%`;
                }
                if (progressLabel) {
                    progressLabel.textContent = `Progresso do Formulário (${totalFieldsIncludingCadastrante}/${totalFields} campos preenchidos - ${filledFields}/11 obrigatórios)`;
                }
                
                setProgressData({ filledFields, progressPercent, strokeOffset });
            }, [values]);

            // Inicialização do círculo de progresso
            React.useEffect(() => {
                const progressRing = document.getElementById('progress-ring-fill');
                if (progressRing) {
                    progressRing.style.strokeDasharray = '251';
                    // Definir progresso inicial (2/13 = ~15%)
                    const initialProgress = 2 / 13;
                    const initialOffset = 251 - (251 * initialProgress);
                    progressRing.style.strokeDashoffset = initialOffset.toString();
                }
            }, []);

            const {
                isVerified,
                isVerifying,
                unidadeEncontrada,
                unidadeNaoEncontrada,
                verificarUnidade,
                limparVerificacao,
                setIsVerified
            } = useUnidadeVerification();

            const handleVerificarUnidade = () => {
                verificarUnidade(values.unidade);
            };

            // Disponibilizar função global para preencher valor controlado do React
            React.useEffect(() => {
                window.preencherCampoReact = function(nomeUnidade) {
                    try {
                        if (!nomeUnidade) return false;
                        // usa setter do useForm para atualizar o estado controlado
                        setValues(prev => ({ ...prev, unidade: nomeUnidade }));
                        return true;
                    } catch (e) {
                        console.error('Erro em preencherCampoReact:', e);
                        return false;
                    }
                };
            }, []);

            const handleFormSubmit = async (formData) => {
                // Validar campos obrigatórios
                const validacao = validarCamposObrigatorios(formData);
                
                if (!validacao.valido) {
                    let mensagemErro = `Por favor, preencha todos os campos obrigatórios. Campos pendentes: ${validacao.camposVazios.length}`;
                    
                    // Verificar se há erro específico do CNES
                    if (validacao.camposVazios.includes('cnes_invalido')) {
                        mensagemErro += '\n⚠️ O código CNES (opcional) deve ter exatamente 7 dígitos numéricos quando preenchido.';
                    }
                    
                    ToastManager.error(mensagemErro, 8000);
                    
                    // Highlight nos campos vazios
                    validacao.camposVazios.forEach(campo => {
                        if (campo === 'cnes_invalido') {
                            const input = document.querySelector(`[name="cnes"]`);
                            if (input) {
                                input.style.borderColor = '#ef4444';
                                input.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                                input.style.background = 'linear-gradient(135deg, #fef2f2 0%, #ffffff 100%)';
                                
                                // Remove highlight após 3 segundos
                                setTimeout(() => {
                                    input.style.borderColor = '';
                                    input.style.boxShadow = '';
                                    input.style.background = '';
                                }, 3000);
                            }
                        } else {
                            const input = document.querySelector(`[name="${campo}"]`);
                            if (input) {
                                input.style.borderColor = '#ef4444';
                                input.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                                
                                // Remove highlight após 3 segundos
                                setTimeout(() => {
                                    input.style.borderColor = '';
                                    input.style.boxShadow = '';
                                }, 3000);
                            }
                        }
                    });
                    
                    throw new Error('Campos obrigatórios não preenchidos');
                }
                
                ToastManager.info('Enviando registro da chamada...', 3000);

                    const dadosEnvio = {
                        ...formData,
                        data_registro: dataHora.toISOString(),
                        telefone: aplicarMascaraTelefone(formData.telefone),
                        cnes: aplicarMascaraCNES(formData.cnes)
                    };

                try {
                    const response = await fetch('/accounts/registro-chamada/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                            },
                            body: JSON.stringify(dadosEnvio)
                        });

                        if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Erro ao enviar formulário');
                    }

                    const result = await response.json();
                    
                    ToastManager.success('Chamada registrada com sucesso! Redirecionando para o histórico...', 3000);
                    
                    // Redirect após sucesso para o histórico
                    setTimeout(() => {
                        window.location.href = '/accounts/historico/';
                    }, 2000);

                    return result;
                    
                } catch (error) {
                    ToastManager.error(`Erro ao registrar chamada: ${error.message}`, 8000);
                    throw error;
                }
            };

            return (
                <div className="main-content">
                    {/* Container de Toasts */}
                    <div className="toast-container" id="toast-container">
                        {/* Toasts serão inseridos aqui dinamicamente */}
                    </div>

                    {/* Header da Página */}
                    <div className="page-header-registro">
                        <div className="header-content-registro">
                            <div className="header-main-registro">
                                <div className="header-icon-registro">
                                    <img src="/static/images/headphones.gif" alt="Headphones" />
                                </div>
                                <div className="header-text-registro">
                                    <h1 className="header-title-registro">Registro de Chamada</h1>
                                    <p className="header-subtitle-registro">Sistema de controle e acompanhamento de chamadas médicas</p>
                                </div>
                            </div>
                            <div className="header-status-registro">
                                <div className="status-badge-online">
                                    <i className="fas fa-circle"></i>
                                    <span>Sistema Online</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Indicador de Progresso */}
                    <div className="progress-indicator-container">
                        <div className="progress-circle">
                            <svg className="progress-ring" width="120" height="120">
                                <circle
                                    className="progress-ring-background"
                                    cx="60"
                                    cy="60"
                                    r="40"
                                />
                                <circle
                                    id="progress-ring-fill"
                                    className="progress-ring-fill"
                                    cx="60"
                                    cy="60"
                                    r="40"
                                />
                            </svg>
                            <div id="progress-text" className="progress-text">
                                15%
                            </div>
                        </div>
                        <div id="progress-label" className="progress-label">
                            Progresso do Formulário (2/13 campos preenchidos - 0/11 obrigatórios)
                        </div>
                    </div>

                    <div className="datetime-section mb-4">
                            <div className="datetime-label">
                                <i className="far fa-clock"></i>
                                Data e Hora do Registro
                            </div>
                            <div className="datetime-value">
                                {formatarDataHora(dataHora)}
                            </div>
                        </div>

                    <form onSubmit={(e) => handleSubmit(e, handleFormSubmit)}>
                        {/* Seção 1: Informações do Solicitante */}
                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">
                                    <i className="fas fa-user"></i>
                                </div>
                                <div>
                                    <h3 className="section-title">Informações do Solicitante</h3>
                                    <p className="section-subtitle">Dados da pessoa que está fazendo a solicitação</p>
                                </div>
                            </div>
                            <div className="section-content">
                                <div className="fields-grid">
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-user-circle"></i>
                                            Nome Completo
                                            <span className="required-star">*</span>
                                        </label>
                                        <InputField
                                            name="nome"
                                            value={values.nome}
                                            onChange={handleChange}
                                            required
                                            error={errors.nome}
                                            placeholder="Digite o nome completo do solicitante"
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Nome oficial conforme documento
                                        </div>
                                    </div>
                                    
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-phone"></i>
                                            Telefone de Contato
                                            <span className="required-star">*</span>
                                        </label>
                                        <InputField
                                            name="telefone"
                                            value={values.telefone}
                                            onChange={handleChange}
                                            required
                                            error={errors.telefone}
                                            placeholder="(67) 99999-9999"
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Inclua DDD do município
                                        </div>
                                    </div>
                                    
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-briefcase"></i>
                                            Função/Cargo
                                            <span className="required-star">*</span>
                                        </label>
                                        <InputField
                                            name="funcao"
                                            value={values.funcao}
                                            onChange={handleChange}
                                            required
                                            error={errors.funcao}
                                            placeholder="Ex: Médico, Enfermeiro, Coordenador"
                                        />
                                    </div>
                                    
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-building"></i>
                                            Setor de Atuação
                                            <span className="required-star">*</span>
                                        </label>
                                        <InputField
                                            name="setor"
                                            value={values.setor}
                                            onChange={handleChange}
                                            required
                                            error={errors.setor}
                                            placeholder="Ex: Urgência, Pediatria, Administração"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Seção 2: Unidade de Saúde */}
                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">
                                    <i className="fas fa-hospital"></i>
                                </div>
                                <div>
                                    <h3 className="section-title">Unidade de Saúde</h3>
                                    <p className="section-subtitle">Identificação e verificação da unidade</p>
                                </div>
                            </div>
                            <div className="section-content">
                                {/* Primeira linha: Nome da Unidade */}
                                <div className="fields-grid">
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-hospital-symbol"></i>
                                            Nome da Unidade de Saúde
                                            <span className="required-star">*</span>
                                        </label>
                                        <UnidadeVerification
                                            value={values.unidade}
                                            onChange={handleChange}
                                            onVerify={handleVerificarUnidade}
                                            isVerified={isVerified}
                                            isLoading={isVerifying}
                                            error={errors.unidade}
                                            unidadeEncontrada={unidadeEncontrada}
                                            unidadeNaoEncontrada={unidadeNaoEncontrada}
                                            onLimparVerificacao={limparVerificacao}
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Digite o nome da unidade e clique em verificar
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Segunda linha: Município da Unidade */}
                                <div className="fields-grid">
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-map-marker-alt"></i>
                                            Município da Unidade de Saúde
                                            <span className="required-star">*</span>
                                        </label>
                                        <MunicipioAutocomplete
                                            name="municipio"
                                            value={values.municipio}
                                            onChange={handleChange}
                                            required
                                            error={errors.municipio}
                                            placeholder="Digite o nome do município..."
                                        />
                                    </div>
                                </div>
                                
                                {/* Terceira linha: Código CNES em destaque */}
                                <div className="fields-grid">
                                    <div className="field-group span-2 cnes-field cnes-field-highlighted">
                                        <div className="cnes-label-container">
                                            <label className="field-label cnes-label-enhanced">
                                                <div className="cnes-label-icon">
                                                    <i className="fas fa-id-card"></i>
                                                </div>
                                                <div className="cnes-label-text">
                                                    <span className="cnes-label-title">Código CNES</span>
                                                    <span className="cnes-label-badge cnes-label-badge-auxilio">Auxílio</span>
                                                </div>
                                            </label>
                                            <div className="cnes-help-text">
                                                <i className="fas fa-info-circle"></i>
                                                Cadastro Nacional de Estabelecimentos de Saúde (Campo auxiliar)
                                            </div>
                                        </div>
                                        
                                        <div className="cnes-attention-banner cnes-attention-banner-info">
                                            <div className="cnes-attention-icon cnes-attention-icon-info">
                                                <i className="fas fa-info-circle"></i>
                                            </div>
                                            <div className="cnes-attention-text cnes-attention-text-info">
                                                <strong>AUXÍLIO:</strong> O código CNES é um campo auxiliar que ajudará na identificação da unidade com dados do Ministério da Saúde
                                            </div>
                                        </div>

                                        <CNESField
                                            name="cnes"
                                            value={values.cnes}
                                            onChange={handleChange}
                                            error={errors.cnes}
                                            placeholder="1234567 (opcional)"
                                            maxLength={7}
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-lightbulb"></i>
                                            <strong>Campo Auxiliar:</strong> Digite o CNES (7 dígitos) para buscar automaticamente dados da unidade no Ministério da Saúde
                                            <br />
                                            <small id="cnes-hint-status">Status: 0/7 dígitos preenchidos - Campo opcional</small>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Quarta linha: Contato Telefônico CNES */}
                                <div className="fields-grid">
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-phone-volume"></i>
                                            Contato Telefônico CNES
                                        </label>
                                        <InputField
                                            name="contato_telefonico_cnes"
                                            value={values.contato_telefonico_cnes}
                                            onChange={handleChange}
                                            error={errors.contato_telefonico_cnes}
                                            placeholder="Telefone será preenchido automaticamente via CNES"
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Campo preenchido automaticamente quando usar os dados do CNES
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Seção 3: Detalhes da Chamada */}
                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">
                                    <img src="/static/images/headphones.gif" alt="Headphones" />
                                </div>
                                <div>
                                    <h3 className="section-title">Detalhes da Chamada</h3>
                                    <p className="section-subtitle">Informações específicas sobre a solicitação</p>
                                </div>
                            </div>
                            <div className="section-content">
                                <div className="fields-grid">
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-tag"></i>
                                            Tipo de Chamada
                                            <span className="required-star">*</span>
                                        </label>
                                        <SelectField
                                            name="tipo_chamada"
                                            value={values.tipo_chamada}
                                            onChange={handleChange}
                                            required
                                            error={errors.tipo_chamada}
                                            options={[
                                                { value: 'outro_nao_especificado', label: 'Outro não especificado' },
                                                { value: 'cadastro_profissional', label: 'Cadastro de profissional' },
                                                { value: 'cadastro_unidade', label: 'Cadastro de Unidade' },
                                                { value: 'cancelamento_solicitacao', label: 'Cancelamento de Solicitacao' },
                                                { value: 'capacidade_operacional', label: 'Capacidade operacional de unidade' },
                                                { value: 'contato', label: 'Contato' },
                                                { value: 'contato_medico_regulador', label: 'Contato com Medico Regulador' },
                                                { value: 'fluxo_funcionamento', label: 'Fluxo de funcionamento do sistema' },
                                                { value: 'fluxo_processo_regulacao', label: 'Fluxo/processo de regulacao' },
                                                { value: 'insercao_unidade_perfil', label: 'Insercao de Unidade em perfil' },
                                                { value: 'login_sistema_core', label: 'Login sistema CORE' },
                                                { value: 'manuseio_uso_sistema', label: 'Manuseio/Uso do sistema' },
                                                { value: 'municipio_sem_internet', label: 'Município sem internet' },
                                                { value: 'pactuacao', label: 'Pactuacao' },
                                                { value: 'psiquiatria', label: 'Psiquiatria' },
                                                { value: 'reset_senha_usuario', label: 'Reset de senha de usuario' },
                                                { value: 'sistema_fora_ar', label: 'Sistema Fora do ar' },
                                                { value: 'sistema_lento', label: 'Sistema Lento' },
                                                { value: 'solicitacao_treinamento', label: 'Solicitacao de treinamento' },
                                                { value: 'suporte_ambulatorial', label: 'Suporte Ambulatorial' },
                                                { value: 'suporte_mabulatorial_leitos', label: 'suporte ao modulo MABULATORIAL E LEITOS' },
                                                { value: 'suporte_leitos', label: 'Suporte Leitos' },
                                                { value: 'unidade_sem_internet', label: 'Unidade sem internet' }
                                            ]}
                                        />
                                    </div>
                                    
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-signal"></i>
                                            Status da Chamada
                                            <span className="required-star">*</span>
                                        </label>
                                        <SelectField
                                            name="status"
                                            value={values.status}
                                            onChange={handleChange}
                                            required
                                            error={errors.status}
                                            options={[
                                                { value: 'chamada_recebida', label: 'Chamada Recebida' },
                                                { value: 'chamada_efetuada', label: 'Chamada Efetuada' }
                                            ]}
                                        />
                                    </div>
                                    
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-user-nurse"></i>
                                            Nome do Atendente
                                            <span className="required-star">*</span>
                                        </label>
                                        <InputField
                                            name="nome_atendente"
                                            value={values.nome_atendente}
                                            onChange={handleChange}
                                            required
                                            error={errors.nome_atendente}
                                            placeholder="Nome completo do atendente responsável"
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Pessoa responsável pelo atendimento desta chamada
                                        </div>
                                    </div>
                                    
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-file-text"></i>
                                            Descrição da Solicitação
                                            <span className="required-star">*</span>
                                        </label>
                                        <TextAreaField
                                            name="descricao"
                                            value={values.descricao}
                                            onChange={handleChange}
                                            required
                                            error={errors.descricao}
                                            placeholder="Descreva detalhadamente a solicitação, problema ou situação relatada..."
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Seja específico para facilitar o atendimento
                                        </div>
                                    </div>
                                    
                                    <div className="field-group span-2">
                                        <label className="field-label">
                                            <i className="fas fa-check-circle"></i>
                                            Solução/Encaminhamento
                                            <span className="required-star">*</span>
                                        </label>
                                        <TextAreaField
                                            name="solucao"
                                            value={values.solucao}
                                            onChange={handleChange}
                                            required
                                            error={errors.solucao}
                                            placeholder="Descreva a solução proposta, encaminhamento realizado ou orientações dadas..."
                                        />
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Registre todas as ações tomadas
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Seção 4: Informações do Cadastrante */}
                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">
                                    <i className="fas fa-user-edit"></i>
                                </div>
                                <div>
                                    <h3 className="section-title">Informações do Cadastrante</h3>
                                    <p className="section-subtitle">Dados sobre quem está realizando este cadastro</p>
                                </div>
                            </div>
                            <div className="section-content">
                                <div className="fields-grid">
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-user-tie"></i>
                                            Responsável pelo Cadastro
                                        </label>
                                        <div className="cadastrante-info-field">
                                            <span className="cadastrante-nome">eduardo</span>
                                        </div>
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Usuário logado responsável por este registro
                                        </div>
                                    </div>
                                    
                                    <div className="field-group">
                                        <label className="field-label">
                                            <i className="fas fa-calendar-alt"></i>
                                            Data do Cadastro
                                        </label>
                                        <div className="cadastrante-info-field">
                                            <span className="cadastrante-data">{formatarDataHora(dataHora)}</span>
                                        </div>
                                        <div className="field-hint">
                                            <i className="fas fa-info-circle"></i>
                                            Data e hora atual do sistema
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Seção de Ações */}
                        <div className="form-section">
                            <div className="action-buttons">
                                <button
                                    type="submit"
                                    className="btn btn-primary"
                                    id="submit-button"
                                    disabled={isLoading || !isVerified}
                                >
                                    {isLoading ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin"></i>
                                            Registrando Chamada...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-save"></i>
                                            Registrar Chamada
                                        </>
                                    )}
                                </button>
                                
                                <button
                                    type="button"
                                    className="btn btn-outline-primary"
                                    onClick={() => window.location.reload()}
                                >
                                    <i className="fas fa-refresh"></i>
                                    Limpar Formulário
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            );
        };

        // Função de teste da API CNES (apenas para desenvolvedores no console)
        async function testarAPICNES() {
            console.log('=== TESTE DA API CNES ===');
            console.log('Esta função está disponível apenas para teste no console do navegador');
            console.log('Use: testarAPICNES() para testar manualmente');
            console.log('========================');
        }

        // Renderizar o aplicativo com tratamento de erro
        (function initializeApp() {
            try {
                const domContainer = document.getElementById('app');
                if (!domContainer) {
                    console.error('Container #app não encontrado');
                    return;
                }
                
                const root = ReactDOM.createRoot(domContainer);
                root.render(<Layout />);
                console.log('App renderizado com sucesso!');
                
                // Disponibilizar funções globalmente para teste
                window.testarAPICNES = testarAPICNES;
                window.consultarCNES = consultarCNES;
                window.consultarUnidadeSaude = consultarUnidadeSaude;
                window.abrirModalCNES = abrirModalCNES;
                window.preencherFormularioComDadosCNES = preencherFormularioComDadosCNES;
                window.preencherCampoMunicipio = window.preencherCampoMunicipio;
                window.preencherCampoTelefoneCNES = window.preencherCampoTelefoneCNES;
                
                // Função de teste para verificar unidades
                window.testarUnidade = async function(nome) {
                    console.log('🧪 TESTANDO CONSULTA DE UNIDADE 🧪');
                    console.log('Nome a ser testado:', nome);
                    console.log('─'.repeat(50));
                    
                    const resultado = await consultarUnidadeSaude(nome);
                    
                    if (resultado.sucesso) {
                        console.log('✅ UNIDADE ENCONTRADA!');
                        console.log('Nome:', resultado.unidade.nome);
                        console.log('Município:', resultado.unidade.municipio);
                        console.log('CNES:', resultado.unidade.cnes);
                        console.log('Telefone:', resultado.unidade.telefone);
                    } else {
                        console.log('❌ UNIDADE NÃO ENCONTRADA');
                        console.log('Erro:', resultado.erro);
                        
                        if (resultado.unidadesSimilares && resultado.unidadesSimilares.length > 0) {
                            console.log('💡 Sugestões (unidades similares):');
                            resultado.unidadesSimilares.forEach((nome, i) => {
                                console.log(`   ${i+1}. "${nome}"`);
                            });
                        }
                        
                        if (resultado.unidadesDisponiveis && resultado.unidadesDisponiveis.length > 0) {
                            console.log('📋 Todas as unidades cadastradas:');
                            resultado.unidadesDisponiveis.forEach((nome, i) => {
                                console.log(`   ${i+1}. "${nome}"`);
                            });
                            console.log('');
                            console.log('💡 DICA: Copie e cole o nome exato de uma das unidades acima');
                        }
                    }
                    
                    console.log('─'.repeat(50));
                    return resultado;
                };
                
                // Logs informativos para o usuário
                console.log('🔧 FUNÇÕES DE DEBUG DISPONÍVEIS:');
                console.log('- window.testarUnidade("nome da unidade") - Testa se uma unidade existe');
                console.log('- window.consultarUnidadeSaude("nome") - Consulta direta da API');
                console.log('');
                console.log('📝 EXEMPLO DE USO:');
                console.log('window.testarUnidade("Hospital Regional");');
                
                // Variáveis globais para debug e testes
                window.ultimosDadosCNES = null;
                window.ultimaUnidadeConsultada = null;
                
                // Função global para marcar unidade como verificada (usada pelo preenchimento automático)
                window.marcarUnidadeComoVerificada = function() {
                    try {
                        // Buscar o botão de verificar unidade
                        const botaoVerificar = document.querySelector('button[type="button"]:not([data-bs-dismiss]):not(.cnes-consult-btn):not(.toast-close)');
                        
                        if (botaoVerificar && botaoVerificar.textContent.includes('Verificar')) {
                            // Simular clique no botão verificar
                            botaoVerificar.click();
                            console.log('Unidade marcada como verificada automaticamente');
                        } else {
                            console.log('Botão verificar não encontrado ou unidade já verificada');
                        }
                    } catch (error) {
                        console.error('Erro ao marcar unidade como verificada:', error);
                    }
                };

                // Função global para preencher campo município automaticamente
                window.preencherCampoMunicipio = function(nomeMunicipio) {
                    try {
                        console.log('Tentando preencher município:', nomeMunicipio);
                        
                        // Buscar o campo de município
                        const campoMunicipio = document.querySelector('input[name="municipio"]');
                        
                        if (campoMunicipio && nomeMunicipio) {
                            // Usar o setter nativo
                            const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
                            nativeInputValueSetter.call(campoMunicipio, nomeMunicipio);
                            
                            // Disparar eventos para o React
                            const inputEvent = new Event('input', { bubbles: true });
                            const changeEvent = new Event('change', { bubbles: true });
                            
                            Object.defineProperty(inputEvent, 'target', { writable: false, value: campoMunicipio });
                            Object.defineProperty(changeEvent, 'target', { writable: false, value: campoMunicipio });
                            
                            campoMunicipio.dispatchEvent(inputEvent);
                            campoMunicipio.dispatchEvent(changeEvent);
                            
                            console.log('Campo município preenchido com:', nomeMunicipio);
                            return true;
                        } else {
                            console.log('Campo município não encontrado ou nome inválido');
                            return false;
                        }
                    } catch (error) {
                        console.error('Erro ao preencher campo município:', error);
                        return false;
                    }
                };

                // Função global para preencher campo telefone CNES automaticamente
                window.preencherCampoTelefoneCNES = function(telefoneUnidade) {
                    try {
                        console.log('Tentando preencher telefone CNES:', telefoneUnidade);
                        
                        // Buscar o campo de contato telefônico CNES
                        const campoTelefone = document.querySelector('input[name="contato_telefonico_cnes"]');
                        
                        if (campoTelefone && telefoneUnidade && telefoneUnidade !== 'Não informado') {
                            // Usar o setter nativo
                            const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
                            nativeInputValueSetter.call(campoTelefone, telefoneUnidade);
                            
                            // Disparar eventos para o React
                            const inputEvent = new Event('input', { bubbles: true });
                            const changeEvent = new Event('change', { bubbles: true });
                            
                            Object.defineProperty(inputEvent, 'target', { writable: false, value: campoTelefone });
                            Object.defineProperty(changeEvent, 'target', { writable: false, value: campoTelefone });
                            
                            campoTelefone.dispatchEvent(inputEvent);
                            campoTelefone.dispatchEvent(changeEvent);
                            
                            // Adicionar efeito visual de sucesso
                            campoTelefone.style.backgroundColor = '#f0fdf4';
                            campoTelefone.style.borderColor = '#16a34a';
                setTimeout(() => {
                                campoTelefone.style.backgroundColor = '';
                                campoTelefone.style.borderColor = '';
                }, 2000);
                            
                            console.log('Campo telefone CNES preenchido com:', telefoneUnidade);
                            return true;
                        } else {
                            console.log('Campo telefone CNES não encontrado ou telefone inválido:', telefoneUnidade);
                            return false;
                        }
                    } catch (error) {
                        console.error('Erro ao preencher campo telefone CNES:', error);
                        return false;
                    }
                };
                
                // Função global para acessar o estado do React e preencher o campo
                window.preencherCampoReact = function(nomeUnidade) {
                    try {
                        // Buscar o componente React no DOM
                        const appElement = document.getElementById('app');
                        if (appElement && appElement._reactInternalFiber) {
                            console.log('Tentando preencher via React Fiber...');
                            // Esta é uma abordagem avançada que pode funcionar com versões mais antigas do React
                        }
                        
                        // Abordagem alternativa: simular digitação caracter por caracter
                        const campoUnidade = document.querySelector('input[name="unidade"]') || 
                                           document.querySelector('.input-group input[type="text"]');
                        
                        if (campoUnidade) {
                            console.log('Simulando digitação caracter por caracter...');
                            
                            // Limpar o campo primeiro
                            campoUnidade.focus();
                            campoUnidade.select();
                            
                            // Simular delete/backspace para limpar
                            document.execCommand('delete');
                            
                            // Simular digitação caracter por caracter
                            nomeUnidade.split('').forEach((char, index) => {
                                setTimeout(() => {
                                    // Criar evento de keydown
                                    const keydownEvent = new KeyboardEvent('keydown', {
                                        key: char,
                                        char: char,
                                        charCode: char.charCodeAt(0),
                                        keyCode: char.charCodeAt(0),
                                        bubbles: true,
                                        cancelable: true
                                    });
                                    
                                    // Criar evento de keypress
                                    const keypressEvent = new KeyboardEvent('keypress', {
                                        key: char,
                                        char: char,
                                        charCode: char.charCodeAt(0),
                                        keyCode: char.charCodeAt(0),
                                        bubbles: true,
                                        cancelable: true
                                    });
                                    
                                    // Disparar eventos
                                    campoUnidade.dispatchEvent(keydownEvent);
                                    campoUnidade.dispatchEvent(keypressEvent);
                                    
                                    // Atualizar valor
                                    const currentValue = campoUnidade.value + char;
                                    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
                                    nativeInputValueSetter.call(campoUnidade, currentValue);
                                    
                                    // Evento de input
                                    const inputEvent = new Event('input', { bubbles: true, cancelable: true });
                                    Object.defineProperty(inputEvent, 'target', { writable: false, value: campoUnidade });
                                    campoUnidade.dispatchEvent(inputEvent);
                                    
                                    // Se for o último caracter
                                    if (index === nomeUnidade.length - 1) {
                                        setTimeout(() => {
                                            const changeEvent = new Event('change', { bubbles: true, cancelable: true });
                                            Object.defineProperty(changeEvent, 'target', { writable: false, value: campoUnidade });
                                            campoUnidade.dispatchEvent(changeEvent);
                                            
                                            console.log('Digitação simulada completa. Valor final:', campoUnidade.value);
                                        }, 50);
                                    }
                                }, index * 50); // 50ms entre cada caracter
                            });
                            
                            return true;
                        }
                        
                        return false;
                    } catch (error) {
                        console.error('Erro ao preencher campo via React:', error);
                        return false;
                    }
                };
                
            } catch (error) {
                console.error('Erro ao renderizar o app:', error);
                
                // Fallback para HTML simples se React falhar
                const appContainer = document.getElementById('app');
                if (appContainer) {
                    appContainer.innerHTML = `
                        <div class="main-content">
                            <h1>Formulário de Registro de Chamada</h1>
                            <p>Erro no carregamento do React. Recarregue a página.</p>
                            <button onclick="window.location.reload()" class="btn btn-primary">
                                Recarregar Página
                            </button>
                        </div>
                    `;
                }
            }
        })();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 